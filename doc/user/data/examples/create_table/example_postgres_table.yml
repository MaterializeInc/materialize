- name: "syntax"
  description: |
    To create a read-only table from a [source](/sql/create-source/) connected
    (via native connector) to an external PostgreSQL:

  code: |
    CREATE TABLE [IF NOT EXISTS] <table_name> FROM SOURCE <source_name> (REFERENCE <upstream_table>)
    [WITH (
        TEXT COLUMNS (<column_name> [, ...])
      | EXCLUDE COLUMNS (<column_name> [, ...])
      [, ...]
    )]
    ;


- name: "syntax-options"
  description: |

    {{< include-md
    file="shared-content/create-table-from-source-snapshotting.md"
    >}}

    {{% yaml-table data="syntax_options/create_table/create_table_options_source_populated_postgres" %}}

    For examples, see [Create a table (PostgreSQL
    source)](/sql/create-table/#create-a-table-postgresql-source).

- name: "syntax-version-requirement"
  description: |
    You must be on **v26+** to use the new syntax.

- name: "create-table"
  description: |

    To create new **read-only** tables from a source table, use the `CREATE
    TABLE ... FROM SOURCE ... (REFERENCE <upstream_table>)` statement. The
    following example creates **read-only** tables `items` and `orders` from the
    PostgreSQL source's `public.items` and `public.orders` tables (the schema is `public`).

    {{< note >}}

    - Although the example creates the tables with the same names as the
    upstream tables, the tables in Materialize can have names that differ from
    the referenced table names.

    - For supported PostgreSQL data types, refer to [supported
    types](/sql/create-table/#supported-data-types).

    {{< /note >}}

  code: |
    /* This example assumes:
      - In the upstream PostgreSQL, you have defined:
        - replication user and password with the appropriate access.
        - a publication named `mz_source` for the `items` and `orders` tables.
      - In Materialize:
        - You have created a secret for the PostgreSQL password.
        - You have defined the connection to the upstream PostgreSQL.
        - You have used the connection to create a source.

       For example (substitute with your configuration):
          CREATE SECRET pgpass AS '<replication user password>'; -- substitute
          CREATE CONNECTION pg_connection TO POSTGRES (
            HOST '<hostname>',          -- substitute
            DATABASE <db>,              -- substitute
            USER <replication user>,    -- substitute
            PASSWORD SECRET pgpass
            -- [, <network security configuration> ]
          );

          CREATE SOURCE pg_source
          FROM POSTGRES CONNECTION pg_connection (
            PUBLICATION 'mz_source'       -- substitute
          );
    */

    CREATE TABLE items
    FROM SOURCE pg_source(REFERENCE public.items)
    ;
    CREATE TABLE orders
    FROM SOURCE pg_source(REFERENCE public.orders)
    ;
  results: |

    {{< include-md
    file="shared-content/create-table-from-source-snapshotting.md" >}}

    {{< include-md file="shared-content/create-table-if-not-exists-tip.md" >}}
- name: "show-tables"
  description: |
    To verify that the table has been created, you can run [`SHOW
    TABLES`](/sql/show-tables/) to list all tables in the current [schema](/sql/namespaces/#namespace-hierarchy):
  code: |
    SHOW TABLES;
  results: |
    The results should include the tables `items` and `orders`:

    ```hc {hl_lines="3-4"}
    | name        | comment |
    | ----------- | ------- |
    | items       |         |
    | orders      |         |
    ```

- name: "show-columns"
  description: |
    Inspect the table columns using the [`SHOW COLUMNS`](/sql/show-columns/) command:
  code: |
    SHOW COLUMNS FROM items;
    SHOW COLUMNS FROM orders;
  results: |
    The results should display information on the table columns. The types
    should match those from the upstream table as the example assumes the
    upstream table only contains columns with data types that are supported in
    Materialize.

    For the list of supported PostgreSQL data types, refer to [supported
    types](/sql/create-table/postgres/#supported-data-types).

- name: "read-from-table"
  description: |
    Once the snapshotting process completes and the table is in the running state, you can query the table:
  code: |
    SELECT * FROM items;
