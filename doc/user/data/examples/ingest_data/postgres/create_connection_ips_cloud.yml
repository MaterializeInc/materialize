- name: "create-secret"
  description: |-
    In the [Materialize Console's SQL Shell](/console/), or your preferred SQL
    client connected to Materialize, use the [`CREATE
    SECRET`](/sql/create-secret/) command to securely store the password for the
    `materialize` PostgreSQL user you created
    [earlier](#2-create-a-publication-and-a-replication-user):

  code: |
    CREATE SECRET pgpass AS '<PASSWORD>';
  test_replacements:
    <PASSWORD>: postgres

- name: "create-connection"
  description: |
    Use the [`CREATE CONNECTION`](/sql/create-connection/) command to create a
    connection object with access and authentication details for Materialize to
    use:

  test_setup: |
    $ postgres-execute connection=postgres://postgres:postgres@postgres
    DROP USER IF EXISTS materialize;
    CREATE USER materialize WITH SUPERUSER PASSWORD 'postgres';
    ALTER USER materialize WITH replication;
    DROP SCHEMA IF EXISTS public CASCADE;
    DROP PUBLICATION IF EXISTS mz_source;
    CREATE SCHEMA PUBLIC;
    CREATE TABLE items (a INT);
    ALTER TABLE items REPLICA IDENTITY FULL;
    CREATE PUBLICATION mz_source FOR ALL TABLES;
  code: |
    CREATE CONNECTION pg_connection TO POSTGRES (
      HOST '<host>',
      PORT 5432,
      USER materialize,
      PASSWORD SECRET pgpass,
      SSL MODE 'require',
      DATABASE '<database>'
    );
  test_replacements:
    <host>: postgres
    <database>: postgres

- name: "create-connection-options-general"
  description: |

    - Replace `<host>` with your PostgreSQL endpoint.

    - Replace `<database>` with the name of the database containing the tables
      you want to replicate to Materialize.

- name: "create-connection-options-aurora"
  description: |
    - Replace `<host>` with the **Writer** endpoint for your Aurora database. To
      find the endpoint, select your database in the AWS Management Console,
      then click the **Connectivity & security** tab and look for the endpoint
      with type **Writer**.

        <div class="warning">
            <strong class="gutter">WARNING!</strong>
            You must use the <strong>Writer</strong> endpoint for the database. Using a <strong>Reader</strong> endpoint will not work.
        </div>

    - Replace `<database>` with the name of the database containing the tables
      you want to replicate to Materialize.

- name: "create-connection-options-rds"
  description: |
    - Replace `<host>` with your RDS endpoint. To find your RDS endpoint, select
    your database in the RDS Console, and look under **Connect & security**

    - Replace `<database>` with the name of the database containing the tables
      you want to replicate to Materialize.
