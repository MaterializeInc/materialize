- test_depends_on: rbac-sm/create_roles.yml

- name: "alter-role-syntax"
  description: |
    The following syntax is used to alter a role in Materialize Self-Managed.
  code: |
    ALTER ROLE <role_name>
    [WITH]
      [ SUPERUSER | NOSUPERUSER ]
      [ LOGIN | NOLOGIN ]
      [ INHERIT | NOINHERIT ]
      [ PASSWORD <text> ]]
    [SET <name> TO <value|DEFAULT> ]
    [RESET <name>]
    ;
  syntax_elements:
    - name: "`INHERIT`"
      description: |
        *Optional.* If specified, grants the role the ability to inherit
        privileges of other roles. *Default.*
    - name: "`LOGIN`"
      description: |
        *Optional.* If specified, allows a role to login via the PostgreSQL or web endpoints
    - name: "`NOLOGIN`"
      description: |
        *Optional.* If specified, prevents a role from logging in. This is the default behavior if `LOGIN` is not specified.

    - name: "`SUPERUSER`"
      description: |
        *Optional.* If specified, grants the role superuser privileges.

    - name: "`NOSUPERUSER`"
      description: |
       *Optional.* If specified, prevents the role from having superuser privileges. This is the default behavior if `SUPERUSER` is not specified.
    - name: "`PASSWORD`"
      description: |
        ***Public Preview***

        *Optional.* This feature may have minor stability issues. If specified,
        allows you to set a password for the role.
    - name: "`SET <name> TO <value|DEFAULT>`"
      description: |
        *Optional.* If specified, sets the configuration parameter for the role
        to the `<value>` or if the value specified is `DEFAULT`, the system's
        default (equivalent to `ALTER ROLE ... RESET <name>`).

        To view the configuration parameter defaults for a role, see
        [`mz_role_parameters`](/sql/system-catalog/mz_catalog#mz_role_parameters).

        {{< note >}}

        - Altering the configuration parameter for a role only affects **new
        sessions**.
        - Role configuration parameters are **not inherited**.

        {{< /note >}}

    - name: "`RESET <name>`"
      description: |
        *Optional.* If specified, resets the configuration parameter for the
        role to the system's default.

        To view the configuration parameter defaults for a role, see
        [`mz_role_parameters`](/sql/system-catalog/mz_catalog#mz_role_parameters).

        {{< note >}}

        - Altering the configuration parameter for a role only affects **new
        sessions**.
        - Role configuration parameters are **not inherited**.

        {{< /note >}}
- name: "alter-role-details"
  description: |
     - Self-Managed Materialize does not support the `NOINHERIT` option for
     `ALTER ROLE`.
     - With the exception of the `SUPERUSER` attribute, Self-Managed Materialize
     does not use role attributes to determine a role's ability to create top
     level objects such as databases and other roles. Instead, Self-Managed
     Materialize uses system level privileges. See [GRANT
     PRIVILEGE](../grant-privilege) for more details.

- name: "alter-roles-configurations"
  description: |

    The following example configures the `blue.berry@example.com` role to use
    the `compute_cluster` cluster, `mydb` database, and `sales` schema by
    default.

  code: |
    ALTER ROLE "blue.berry@example.com" SET CLUSTER = compute_cluster;
    ALTER ROLE "blue.berry@example.com" SET DATABASE = mydb;
    ALTER ROLE "blue.berry@example.com" SET search_path = sales; -- i.e., schema
  results: |

    - These changes will take effect in the next session for the role; the
      changes have **NO** effect on the current session.

    - These configurations are just the defaults. For example, the connection
      string can specify a different database for the session or the user can
      issue a `SET ...` command to override these values for the current
      session.
  testable_results: false

- name: "alter-roles-configs-not-inherited"
  description: |

    In Materialize, when you grant a role to another role (user role/service
    account role/independent role), the target role inherits only the privileges
    of the granted role. **Role configurations are not inherited.** For example,
    the following example updates the `data_reader` role to use
    `serving_cluster` by default.

  test_setup: |
    > CREATE CLUSTER serving_cluster SIZE 'scale=1,workers=1'
  code: |
    ALTER ROLE data_reader SET CLUSTER = serving_cluster;
  results: |

    This change affects only the `data_reader` role and does not affect roles
    that have been granted `data_reader`, such as `sales_report_app`. That is,
    after this change:

    - The default cluster for `data_reader` is `serving_cluster` for new
      sessions.

    - The default cluster for `sales_report_app` is not affected.

    {{< tip >}}
    {{% include-headless "/headless/rbac-sm/alter-role-tip" %}}
    {{</ tip >}}
  testable_results: false
