- test_depends_on: rbac-sm/create_roles.yml

- name: "for-user"
  description: |

    To view privileges for a user, run [`SHOW PRIVILEGES`](/sql/show-privileges)
    on the user's role. For example, show the privileges for the `blue.berry@example.com` role created in the
    [Create a role section](#create-individual-userservice-account-roles).

  code: |
    SHOW PRIVILEGES FOR "blue.berry@example.com";
  test_results: |
    mz_system PUBLIC <null> <null> materialize database USAGE
    mz_system PUBLIC <null> <null> quickstart cluster USAGE
    mz_system PUBLIC materialize <null> public schema USAGE

- name: "for-service-account"
  description: |

    To view privileges for a service account, run [`SHOW
    PRIVILEGES`](/sql/show-privileges) on the service account's role. For example, show the privileges for the `sales_report_app` role created in the
    [Create a role section](#create-individual-userservice-account-roles).

  code: |
    SHOW PRIVILEGES FOR sales_report_app;
  test_results: |
    mz_system PUBLIC <null> <null> materialize database USAGE
    mz_system PUBLIC <null> <null> quickstart cluster USAGE
    mz_system PUBLIC materialize <null> public schema USAGE

- name: "for-view-manager"
  description: |

    Show the privileges for the `view_manager` role created in the
    [Create a role section](#create-a-role).

  code: |
    SHOW PRIVILEGES FOR view_manager;
  test_results: |
    mz_system PUBLIC <null> <null> materialize database USAGE
    mz_system PUBLIC <null> <null> quickstart cluster USAGE
    mz_system PUBLIC materialize <null> public schema USAGE

- name: "for-serving-index-manager"
  description: |

    Show the privileges for the `serving_index_manager` role created in the
    [Create a role section](#create-a-role).

  code: |
    SHOW PRIVILEGES FOR serving_index_manager;
  test_results: |
    mz_system PUBLIC <null> <null> materialize database USAGE
    mz_system PUBLIC <null> <null> quickstart cluster USAGE
    mz_system PUBLIC materialize <null> public schema USAGE


- name: "for-data-reader"
  description: |

    Show the privileges for the `data_reader` role created in the
    [Create a role section](#create-a-role).

  code: |
    SHOW PRIVILEGES FOR data_reader;
  test_results: |
    mz_system PUBLIC <null> <null> materialize database USAGE
    mz_system PUBLIC <null> <null> quickstart cluster USAGE
    mz_system PUBLIC materialize <null> public schema USAGE

- name: "example-results"
  description: |

    The results show that the role currently has only the privileges inherited
    through the `PUBLIC` role.

    ```none
    | grantor   | grantee | database    | schema | name        | object_type | privilege_type |
    | --------- | ------- | ----------- | ------ | ----------- | ----------- | -------------- |
    | mz_system | PUBLIC  | materialize | null   | public      | schema      | USAGE          |
    | mz_system | PUBLIC  | mydb        | null   | public      | schema      | USAGE          |
    | mz_system | PUBLIC  | null        | null   | materialize | database    | USAGE          |
    | mz_system | PUBLIC  | null        | null   | quickstart  | cluster     | USAGE          |
    ```
