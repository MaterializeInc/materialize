# Source: materialize-environmentd/templates/secret.yaml
# Copyright Materialize, Inc. and contributors. All rights reserved.
#
# Use of this software is governed by the Business Source License
# included in the LICENSE file at the root of this repository.
#
# As of the Change Date specified in that file, in accordance with
# the Business Source License, use of this software will be governed
# by the Apache License, Version 2.0.

apiVersion: v1
kind: Namespace
metadata:
  name: materialize-environment
---
apiVersion: v1
kind: Secret
metadata:
  name: materialize-backend
stringData:
  metadata_backend_url: "postgres://root@cockroach.default.svc.cluster.local:26257"
  persist_backend_url: "s3://minio:minio123@persist?endpoint=http%3A%2F%2Fminio-service.default.svc.cluster.local%3A9000&region=minio"
---
apiVersion: materialize.cloud/v1alpha1
kind: Materialize
metadata:
  name: 12345678-1234-1234-1234-123456789012
spec:
  environmentdImageRef: materialize/environmentd:v0.132.0
  backendSecretName: materialize-backend
  #balancerdExternalCertificateSpec:
  #  dnsNames:
  #    - balancerd
  #  issuerRef:
  #    name: dns01
  #    kind: ClusterIssuer
  #consoleExternalCertificateSpec:
  #  dnsNames:
  #    - console
  #  issuerRef:
  #    name: dns01
  #    kind: ClusterIssuer
  #internalCertificateSpec:
  #  issuerRef:
  #    name: intermediate-ca
  #    kind: Issuer
  environmentdExtraArgs:
    - "--unsafe-mode"
    - "--orchestrator-kubernetes-ephemeral-volume-class=standard"
    - "--system-parameter-default=enable_unsafe_functions=true;unsafe_enable_unsafe_functions=true;persist_next_listen_batch_retryer_clamp=16s;persist_next_listen_batch_retryer_initial_backoff=100ms;persist_next_listen_batch_retryer_fixed_sleep=1200ms;persist_enable_arrow_lgalloc_noncc_sizes=true;persist_enable_s3_lgalloc_noncc_sizes=true;persist_enable_one_alloc_per_request=true;allow_real_time_recency=true;cluster_always_use_disk=true;compute_dataflow_max_inflight_bytes=134217728;compute_hydration_concurrency=2;compute_replica_expiration_offset=3d;compute_apply_column_demands=true;disk_cluster_replicas_default=true;enable_0dt_deployment=false;enable_0dt_deployment_panic_after_timeout=true;enable_0dt_deployment_sources=true;enable_alter_swap=true;enable_columnation_lgalloc=true;enable_compute_chunked_stack=true;enable_connection_validation_syntax=true;enable_continual_task_builtins=true;enable_continual_task_create=true;enable_continual_task_retain=true;enable_continual_task_transform=true;enable_copy_to_expr=true;enable_create_table_from_source=true;enable_disk_cluster_replicas=true;enable_eager_delta_joins=true;enable_envelope_debezium_in_subscribe=true;enable_expressions_in_limit_syntax=true;enable_introspection_subscribes=true;enable_kafka_sink_partition_by=true;enable_logical_compaction_window=true;enable_multi_worker_storage_persist_sink=true;enable_rbac_checks=true;enable_reduce_mfp_fusion=true;enable_refresh_every_mvs=true;enable_cluster_schedule_refresh=true;enable_statement_lifecycle_logging=true;enable_table_keys=true;unsafe_enable_table_keys=true;enable_variadic_left_join_lowering=true;enable_worker_core_affinity=true;kafka_default_metadata_fetch_interval=1s;mysql_offset_known_interval=1s;persist_record_schema_id=true;force_source_table_syntax=false;persist_batch_columnar_format=both_v2;persist_batch_delete_enabled=true;persist_batch_structured_order=true;persist_batch_structured_key_lower_len=256;persist_batch_max_run_len=4;persist_catalog_force_compaction_fuel=1024;persist_catalog_force_compaction_wait=1s;persist_fast_path_limit=1000;persist_inline_writes_single_max_bytes=4096;persist_inline_writes_total_max_bytes=1048576;persist_pubsub_client_enabled=true;persist_pubsub_push_diff_enabled=true;persist_record_compactions=true;persist_blob_target_size=16777216;persist_stats_audit_percent=100;persist_use_critical_since_catalog=true;persist_use_critical_since_snapshot=true;persist_use_critical_since_source=true;persist_part_decode_format=row_with_validate;pg_offset_known_interval=1s;statement_logging_default_sample_rate=0.01;statement_logging_max_sample_rate=0.01;storage_reclock_to_latest=true;storage_source_decode_fuel=100000;storage_statistics_collection_interval=1000;storage_statistics_interval=2000;storage_use_continual_feedback_upsert=true;storage_use_reclock_v2=true;with_0dt_deployment_max_wait=1800s;upsert_rocksdb_auto_spill_to_disk=false"
