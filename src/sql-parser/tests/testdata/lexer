# Copyright Materialize, Inc. All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License in the LICENSE file at the
# root of this repository, or online at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Tests that primary exercise the lexer. Since the lexer isn't public API,
# we don't bother testing it directly, but test it via the parser.

# Comments.
parse-statement roundtrip
SELECT
-- this is a comment
1
----
SELECT 1

parse-statement roundtrip
SELECT /*** this * is ***/ 1 /* a /** nested */ comment */, 2
----
SELECT 1, 2

parse-statement roundtrip
SELECT /* blah blah blah
----
error:
Parse error:
SELECT /* blah blah blah
       ^^^^^^^^^^^^^^^^^
unterminated multiline comment

parse-statement roundtrip
SELECT @@/*
----
error:
Parse error:
SELECT @@/*
         ^^
unterminated multiline comment

# String adjacency.

parse-statement roundtrip
SELECT 'foo'

'bar'



'baz'
----
SELECT 'foobarbaz'

parse-statement roundtrip
SELECT 'foo'  'bar'
----
error:
Parse error:
SELECT 'foo'  'bar'
              ^^^^^
Expected end of statement, found string literal

parse-statement roundtrip
SELECT e'foo'
e'bar'
----
error:
Parse error:
e'bar'
^^^^^^
Expected end of statement, found string literal

parse-statement roundtrip
SELECT e'\u2713'
'\u2713'
----
SELECT 'âœ“âœ“'

# Escape string literals.

parse-scalar
e'a\z\8\b\n\f\r\t\u2713\U0001F47B'
----
Value(String("az8\u{8}\n\u{c}\r\tâœ“ðŸ‘»"))

parse-scalar
e'\018'
----
error:
Parse error:
e'\018'
  ^^^
octal escapes are not supported

parse-scalar
e'\x1fg'
----
error:
Parse error:
e'\x1fg'
  ^^^^
hexadecimal escapes are not supported

# Dollar string literals.

parse-statement roundtrip
SELECT $$Postgre's SQL$$, $eOf$Postgre's SQL$eOf$, end
----
SELECT '$Postgre''s SQL', '$Postgre''s SQL', end

parse-statement roundtrip
SELECT $$POST
----
error:
Parse error:
SELECT $$POST
       ^^^^^^
unterminated dollar-quoted string

parse-statement roundtrip
SELECT $EOF$PostgreSQL$$eof$$
----
error:
Parse error:
SELECT $EOF$PostgreSQL$$eof$$
       ^^^^^^^^^^^^^^^^^^^^^^
unterminated dollar-quoted string

# Numeric literals
parse-scalar
10
----
Value(Number("10"))

parse-scalar
10E10
----
Value(Number("10E10"))

parse-scalar
10E-10
----
Value(Number("10E-10"))

parse-scalar
10e-10
----
Value(Number("10E-10"))

parse-scalar
10e+10
----
Value(Number("10E10"))

parse-scalar
1.1e10
----
Value(Number("1.1E10"))

parse-scalar
1e10.1
----
error:
Parse error:
1e10.1
    ^^
extra token after expression
