2024-01-17T10:53:25-05:00
INITIALIZING
Timing is on.
1705506805
DROP TABLE
Time: 322.265 ms
DROP TABLE
Time: 306.874 ms
DROP TABLE
Time: 331.392 ms
DROP TABLE
Time: 389.743 ms
DROP TABLE
Time: 411.526 ms
DROP TABLE
Time: 510.020 ms
DROP TABLE
Time: 411.172 ms
DROP TABLE
Time: 249.061 ms
DROP TABLE
Time: 268.148 ms
DROP TABLE
Time: 345.848 ms
DROP TABLE
Time: 363.712 ms
DROP TABLE
Time: 408.717 ms
DROP TABLE
Time: 307.734 ms
DROP TABLE
Time: 281.716 ms
DROP TABLE
Time: 335.067 ms
DROP TABLE
Time: 329.336 ms
DROP TABLE
Time: 335.192 ms
DROP TABLE
Time: 210.098 ms
OLD TABLES DROPPED
2024-01-17T10:53:31-05:00
CREATE TABLE
Time: 555.322 ms
CREATE INDEX
Time: 593.850 ms
CREATE TABLE
Time: 590.921 ms
CREATE INDEX
Time: 735.384 ms
CREATE TABLE
Time: 611.972 ms
CREATE INDEX
Time: 512.190 ms
CREATE INDEX
Time: 513.400 ms
CREATE INDEX
Time: 516.526 ms
CREATE TABLE
Time: 541.308 ms
CREATE INDEX
Time: 580.680 ms
CREATE INDEX
Time: 479.511 ms
CREATE TABLE
Time: 519.353 ms
CREATE INDEX
Time: 571.045 ms
CREATE TABLE
Time: 680.203 ms
CREATE INDEX
Time: 465.634 ms
CREATE INDEX
Time: 437.152 ms
CREATE TABLE
Time: 487.075 ms
CREATE INDEX
Time: 498.607 ms
CREATE TABLE
Time: 549.100 ms
CREATE INDEX
Time: 536.601 ms
CREATE INDEX
Time: 508.353 ms
CREATE TABLE
Time: 791.330 ms
CREATE TABLE
Time: 602.911 ms
CREATE TABLE
Time: 658.495 ms
CREATE INDEX
Time: 620.018 ms
CREATE INDEX
Time: 557.282 ms
CREATE TABLE
Time: 749.489 ms
CREATE TABLE
Time: 732.676 ms
CREATE INDEX
Time: 461.727 ms
CREATE TABLE
Time: 557.073 ms
CREATE TABLE
Time: 619.886 ms
CREATE TABLE
Time: 562.235 ms
CREATE INDEX
Time: 501.870 ms
CREATE INDEX
Time: 465.522 ms
CREATE TABLE
Time: 487.626 ms
CREATE INDEX
Time: 639.454 ms
CREATE INDEX
Time: 511.952 ms
CREATE TABLE
Time: 618.206 ms
CREATE INDEX
Time: 482.955 ms
CREATE INDEX
Time: 512.510 ms
CREATE INDEX
Time: 638.322 ms
COPY 7955
Time: 600.359 ms
COPY 1460
Time: 390.336 ms
COPY 16080
Time: 473.414 ms
COPY 71
Time: 167.785 ms
COPY 0
Time: 23.430 ms
COPY 1647261
Time: 38604.375 ms (00:38.604)
COPY 92177
Time: 2517.308 ms (00:02.517)
COPY 0
Time: 27.658 ms
COPY 2060925
Time: 14625.925 ms (00:14.626)
COPY 115206
Time: 1288.633 ms (00:01.289)
COPY 95138
Time: 2003.965 ms (00:02.004)
COPY 5689
Time: 437.265 ms
COPY 0
Time: 23.326 ms
COPY 2757277
Time: 22400.571 ms (00:22.401)
COPY 152491
Time: 1523.012 ms (00:01.523)
COPY 309114
Time: 2572.714 ms (00:02.573)
COPY 19470
Time: 360.959 ms
COPY 9699
Time: 761.888 ms
COPY 596
Time: 309.060 ms
COPY 223675
Time: 1944.897 ms (00:01.945)
COPY 14377
Time: 448.197 ms
COPY 163388
Time: 1877.683 ms (00:01.878)
COPY 163388
Time: 1767.024 ms (00:01.767)
COPY 9626
Time: 613.673 ms
COPY 9626
Time: 616.426 ms
COPY 7821
Time: 440.608 ms
COPY 488
Time: 482.636 ms
COPY 20816
Time: 502.840 ms
COPY 1228
Time: 314.021 ms
COPY 0
Time: 31.634 ms
COPY 1053319
Time: 7945.496 ms (00:07.945)
COPY 56494
Time: 723.498 ms
COPY 717755
Time: 5643.155 ms (00:05.643)
COPY 42700
Time: 599.820 ms
COPY 0
Time: 22.886 ms
COPY 1058976
Time: 27223.629 ms (00:27.224)
COPY 62250
Time: 2225.585 ms (00:02.226)
COPY 710297
Time: 5138.803 ms (00:05.139)
COPY 41636
Time: 721.844 ms
CREATE MATERIALIZED VIEW
Time: 709.283 ms
CREATE INDEX
Time: 416.493 ms
CREATE MATERIALIZED VIEW
Time: 431.121 ms
CREATE INDEX
Time: 428.378 ms
CREATE INDEX
Time: 541.737 ms
CREATE MATERIALIZED VIEW
Time: 639.801 ms
CREATE INDEX
Time: 525.956 ms
CREATE MATERIALIZED VIEW
Time: 599.989 ms
CREATE INDEX
Time: 433.139 ms
CREATE MATERIALIZED VIEW
Time: 402.708 ms
CREATE INDEX
Time: 391.862 ms
CREATE INDEX
Time: 448.337 ms
CREATE MATERIALIZED VIEW
Time: 452.879 ms
CREATE INDEX
Time: 431.922 ms
CREATE INDEX
Time: 457.809 ms
CREATE MATERIALIZED VIEW
Time: 448.913 ms
CREATE INDEX
Time: 498.027 ms
CREATE INDEX
Time: 640.458 ms
CREATE INDEX
Time: 479.302 ms
CREATE INDEX
Time: 751.885 ms
CREATE INDEX
Time: 728.812 ms
CREATE VIEW
Time: 495.742 ms
CREATE VIEW
Time: 515.393 ms
1705506995
2024-01-17T10:56:35-05:00
RUNNING QUERIES

Q10 EXPLAINED
                                                                                  Optimized Plan                                                                                  
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Explained Query:                                                                                                                                                                +
   Finish order_by=[#2 desc nulls_first, #1{name} asc nulls_last, #0{person2id} asc nulls_last] limit=100 output=[#0..=#2]                                                       +
     Return // { arity: 3 }                                                                                                                                                      +
       Reduce group_by=[#0{person2id}, #1{name}] aggregates=[count(*)] // { arity: 3 }                                                                                           +
         Project (#0, #9) // { arity: 2 }                                                                                                                                        +
           Join on=(#0{person2id} = #1{id} = #2{creatorpersonid} AND #3{messageid} = #4{messageid} = #6{messageid} AND #7{tagid} = #8{id}) type=differential // { arity: 12 }    +
             implementation                                                                                                                                                      +
               %0[#0]UKA » %1[#0]UKA » %2[#0]K » %3[#0]UKA » %4:message_hastag_tag[#1]KA » %5:tag[#0]KA                                                                          +
             ArrangeBy keys=[[#0{person2id}]] // { arity: 1 }                                                                                                                    +
               Distinct project=[#0{person2id}] // { arity: 1 }                                                                                                                  +
                 Threshold // { arity: 1 }                                                                                                                                       +
                   Union // { arity: 1 }                                                                                                                                         +
                     Distinct project=[#0{person2id}] // { arity: 1 }                                                                                                            +
                       Project (#6) // { arity: 1 }                                                                                                                              +
                         Join on=(#0{person2id} = #2{person1id} AND #3{person2id} = #5{person1id}) type=delta // { arity: 7 }                                                    +
                           implementation                                                                                                                                        +
                             %0:l2 » %1:person_knows_person[#1]KA » %2:l0[#1]KA                                                                                                  +
                             %1:person_knows_person » %0:l2[#0]UKA » %2:l0[#1]KA                                                                                                 +
                             %2:l0 » %1:person_knows_person[#2]KA » %0:l2[#0]UKA                                                                                                 +
                           ArrangeBy keys=[[#0{person2id}]] // { arity: 1 }                                                                                                      +
                             Get l2 // { arity: 1 }                                                                                                                              +
                           ArrangeBy keys=[[#1{person1id}], [#2{person2id}]] // { arity: 3 }                                                                                     +
                             ReadIndex on=person_knows_person person_knows_person_person1id=[delta join lookup] person_knows_person_person2id=[delta join lookup] // { arity: 3 }+
                           Get l0 // { arity: 3 }                                                                                                                                +
                     Negate // { arity: 1 }                                                                                                                                      +
                       Get l2 // { arity: 1 }                                                                                                                                    +
             ArrangeBy keys=[[#0{id}]] // { arity: 1 }                                                                                                                           +
               Distinct project=[#0{id}] // { arity: 1 }                                                                                                                         +
                 Project (#1) // { arity: 1 }                                                                                                                                    +
                   Filter (#16{name} = "Italy") AND (#14{partofcountryid}) IS NOT NULL // { arity: 19 }                                                                          +
                     Join on=(#8{locationcityid} = #11{id} AND #14{partofcountryid} = #15{id}) type=delta // { arity: 19 }                                                       +
                       implementation                                                                                                                                            +
                         %0:person » %1:city[#0]KA » %2:country[#0]KAef                                                                                                          +
                         %1:city » %2:country[#0]KAef » %0:person[#8]KA                                                                                                          +
                         %2:country » %1:city[#3]KA » %0:person[#8]KA                                                                                                            +
                       ArrangeBy keys=[[#8{locationcityid}]] // { arity: 11 }                                                                                                    +
                         ReadIndex on=person person_locationcityid=[delta join 1st input (full scan)] // { arity: 11 }                                                           +
                       ArrangeBy keys=[[#0{id}], [#3{partofcountryid}]] // { arity: 4 }                                                                                          +
                         ReadIndex on=city city_id=[delta join lookup] city_partofcountryid=[delta join lookup] // { arity: 4 }                                                  +
                       ArrangeBy keys=[[#0{id}]] // { arity: 4 }                                                                                                                 +
                         ReadIndex on=country country_id=[delta join lookup] // { arity: 4 }                                                                                     +
             ArrangeBy keys=[[#0{creatorpersonid}]] // { arity: 2 }                                                                                                              +
               Distinct project=[#1{creatorpersonid}, #0{messageid}] // { arity: 2 }                                                                                             +
                 Project (#1, #9) // { arity: 2 }                                                                                                                                +
                   ReadIndex on=message message_messageid=[*** full scan ***] // { arity: 13 }                                                                                   +
             ArrangeBy keys=[[#0{messageid}]] // { arity: 1 }                                                                                                                    +
               Distinct project=[#0{messageid}] // { arity: 1 }                                                                                                                  +
                 Project (#1) // { arity: 1 }                                                                                                                                    +
                   Join on=(#2{tagid} = #3{id} AND #6{typetagclassid} = #7{id}) type=delta // { arity: 12 }                                                                      +
                     implementation                                                                                                                                              +
                       %0:message_hastag_tag » %1:tag[#0]KA » %2:tagclass[#0]KAe                                                                                                 +
                       %1:tag » %2:tagclass[#0]KAe » %0:message_hastag_tag[#2]KA                                                                                                 +
                       %2:tagclass » %1:tag[#3]KA » %0:message_hastag_tag[#2]KA                                                                                                  +
                     ArrangeBy keys=[[#2{tagid}]] // { arity: 3 }                                                                                                                +
                       ReadIndex on=message_hastag_tag message_hastag_tag_tagid=[delta join 1st input (full scan)] // { arity: 3 }                                               +
                     ArrangeBy keys=[[#0{id}], [#3{typetagclassid}]] // { arity: 4 }                                                                                             +
                       ReadIndex on=tag tag_id=[delta join lookup] tag_typetagclassid=[delta join lookup] // { arity: 4 }                                                        +
                     ArrangeBy keys=[[#0{id}]] // { arity: 5 }                                                                                                                   +
                       ReadIndex on=materialize.public.tagclass tagclass_name=[lookup value=("Thing")] // { arity: 5 }                                                           +
             ArrangeBy keys=[[#1{messageid}]] // { arity: 3 }                                                                                                                    +
               ReadIndex on=message_hastag_tag message_hastag_tag_messageid=[differential join] // { arity: 3 }                                                                  +
             ArrangeBy keys=[[#0{id}]] // { arity: 4 }                                                                                                                           +
               ReadIndex on=tag tag_id=[differential join] // { arity: 4 }                                                                                                       +
     With                                                                                                                                                                        +
       cte l2 =                                                                                                                                                                  +
         Distinct project=[#0{person2id}] // { arity: 1 }                                                                                                                        +
           Union // { arity: 1 }                                                                                                                                                 +
             Project (#2) // { arity: 1 }                                                                                                                                        +
               Get l1 // { arity: 4 }                                                                                                                                            +
             Project (#6) // { arity: 1 }                                                                                                                                        +
               Join on=(#2{person2id} = #5{person1id}) type=differential // { arity: 7 }                                                                                         +
                 implementation                                                                                                                                                  +
                   %0:l1[#2]KAe » %1:l0[#1]KAe                                                                                                                                   +
                 ArrangeBy keys=[[#2{person2id}]] // { arity: 4 }                                                                                                                +
                   Get l1 // { arity: 4 }                                                                                                                                        +
                 Get l0 // { arity: 3 }                                                                                                                                          +
       cte l1 =                                                                                                                                                                  +
         ReadIndex on=materialize.public.person_knows_person person_knows_person_person1id=[lookup value=(6597069770479)] // { arity: 4 }                                        +
       cte l0 =                                                                                                                                                                  +
         ArrangeBy keys=[[#1{person1id}]] // { arity: 3 }                                                                                                                        +
           ReadIndex on=person_knows_person person_knows_person_person1id=[differential join, delta join lookup, lookup] // { arity: 3 }                                         +
                                                                                                                                                                                 +
 Used Indexes:                                                                                                                                                                   +
   - materialize.public.tag_id (differential join, delta join lookup)                                                                                                            +
   - materialize.public.tag_typetagclassid (delta join lookup)                                                                                                                   +
   - materialize.public.tagclass_name (lookup)                                                                                                                                   +
   - materialize.public.person_locationcityid (delta join 1st input (full scan))                                                                                                 +
   - materialize.public.person_knows_person_person1id (differential join, delta join lookup, lookup)                                                                             +
   - materialize.public.person_knows_person_person2id (delta join lookup)                                                                                                        +
   - materialize.public.country_id (delta join lookup)                                                                                                                           +
   - materialize.public.city_id (delta join lookup)                                                                                                                              +
   - materialize.public.city_partofcountryid (delta join lookup)                                                                                                                 +
   - materialize.public.message_hastag_tag_messageid (differential join)                                                                                                         +
   - materialize.public.message_hastag_tag_tagid (delta join 1st input (full scan))                                                                                              +
   - materialize.public.message_messageid (*** full scan ***)                                                                                                                    +
 
(1 row)

Time: 60.042 ms
Q10 RUN 1
   person.id    |             tag.name              | messagecount 
----------------+-----------------------------------+--------------
  2199023257601 | Ralph_Vaughan_Williams            |            3
  2199023257601 | Aristophanes                      |            2
 15393162799165 | Aristophanes                      |            2
 19791209309107 | Aristophanes                      |            2
           6079 | Augustine_of_Hippo                |            2
 30786325585300 | Bob_Hope                          |            2
  2199023257601 | Canada                            |            2
 15393162799165 | Dmitry_Medvedev                   |            2
  2199023259874 | Franklin_D._Roosevelt             |            2
 15393162793184 | Interpol                          |            2
  2199023257601 | Jean-Baptiste_Lamarck             |            2
  2199023261968 | Johannes_Brahms                   |            2
 19791209309107 | John_Cage                         |            2
 19791209309107 | Leonard_Bernstein                 |            2
  2199023259874 | Ludwig_van_Beethoven              |            2
  4398046512280 | Muammar_Gaddafi                   |            2
  2199023257601 | Mughal_Empire                     |            2
 30786325581417 | Plácido_Domingo                   |            2
  2199023257601 | Slavoj_Žižek                      |            2
 30786325581417 | Wayne_Gretzky                     |            2
  2199023261968 | Wolfgang_Amadeus_Mozart           |            2
           9043 | 14th_Dalai_Lama                   |            1
  2199023257601 | 14th_Dalai_Lama                   |            1
  4398046512280 | 14th_Dalai_Lama                   |            1
            217 | 99_Luftballons                    |            1
 30786325585300 | A_Day_Without_Rain                |            1
 28587302322352 | A_Kind_of_Magic                   |            1
  2199023259874 | A_Little_Bit_Me,_a_Little_Bit_You |            1
           7684 | A_Whiter_Shade_of_Pale            |            1
 15393162793184 | Aaron_Copland                     |            1
 17592186053088 | Abbasid_Caliphate                 |            1
 32985348842018 | Adolf_Hitler                      |            1
            217 | Alan_Moore                        |            1
 19791209309107 | Albert_Einstein                   |            1
            217 | Alexander_Downer                  |            1
 19791209310154 | Alexander_Pushkin                 |            1
  4398046517288 | Alfred,_Lord_Tennyson             |            1
  2199023259874 | Alfred_Hitchcock                  |            1
           9043 | Ali                               |            1
  2199023257601 | Ali                               |            1
  4398046512280 | Ali                               |            1
 21990232560354 | Ali                               |            1
 21990232564061 | All_the_Roadrunning               |            1
 32985348842085 | Ammon                             |            1
           6079 | Andrew_Jackson                    |            1
 19791209309107 | Angola                            |            1
 30786325581056 | Another_One_Bites_the_Dust        |            1
  2199023257601 | Anton_Chekhov                     |            1
  4398046512280 | Are_You_Experienced               |            1
 21990232564061 | Arenberg                          |            1
            217 | Aristophanes                      |            1
  2199023259874 | Aristophanes                      |            1
 30786325585300 | Aristophanes                      |            1
           6079 | Aristotle                         |            1
 10995116279128 | Arnold_Schwarzenegger             |            1
 32985348842085 | Arthur_William_Baden_Powell       |            1
 19791209309107 | Ashikaga_shogunate                |            1
 30786325585300 | At_Last                           |            1
 28587302322352 | At_War_with_the_Mystics           |            1
 30786325581417 | Augustin_Pyramus_de_Candolle      |            1
 10995116285979 | Augustine_of_Hippo                |            1
 32985348842085 | Augustine_of_Hippo                |            1
           9043 | Austrian_Empire                   |            1
 19791209310154 | Banned_in_the_U.S.A.              |            1
  2199023257601 | Barbra_Streisand                  |            1
  2199023257601 | Barrio_Fino                       |            1
  2199023259874 | Barry_Manilow                     |            1
  2199023259874 | Before_You_Were_Punk              |            1
 30786325581417 | Benjamin_Harrison                 |            1
 30786325585300 | Bertolt_Brecht                    |            1
 19791209309107 | Bill_Clinton                      |            1
 30786325585300 | Bill_Clinton                      |            1
 32985348842018 | Blood_Sugar_Sex_Magik             |            1
  2199023257601 | Bob_Dole                          |            1
 19791209309107 | Bob_Dylan                         |            1
 32985348842085 | Botswana                          |            1
 10995116279128 | Break_Like_the_Wind               |            1
 30786325585300 | Breathe_Again                     |            1
 21990232564061 | British_Ceylon                    |            1
  2199023261968 | British_Empire                    |            1
  2199023257601 | Burma                             |            1
 19791209309107 | Busta_Rhymes                      |            1
 30786325581417 | Busta_Rhymes                      |            1
 30786325585300 | Béla_Bartók                       |            1
 19791209309107 | C._S._Lewis                       |            1
 21990232564061 | Cameroon                          |            1
 35184372093958 | Cannot_Buy_My_Soul                |            1
  2199023257601 | Cape_Verde                        |            1
 19791209310154 | Carl_Gustaf_Emil_Mannerheim       |            1
  4398046518779 | Chaka_Khan                        |            1
  2199023259874 | Champa                            |            1
           7684 | Charles_Dickens                   |            1
 32985348842085 | Charles_II_of_England             |            1
 30786325585300 | Charles_I_of_England              |            1
 15393162793184 | Charlton_Heston                   |            1
  4398046517288 | Che_Guevara                       |            1
 30786325581417 | Christopher_Columbus              |            1
  2199023257601 | Chrome_Dreams_II                  |            1
 10995116279128 | Claude_Debussy                    |            1
 10995116285979 | Claude_Debussy                    |            1
(100 rows)

Time: 59282.354 ms (00:59.282)
Q10 RUN 2
   person.id    |             tag.name              | messagecount 
----------------+-----------------------------------+--------------
  2199023257601 | Ralph_Vaughan_Williams            |            3
  2199023257601 | Aristophanes                      |            2
 15393162799165 | Aristophanes                      |            2
 19791209309107 | Aristophanes                      |            2
           6079 | Augustine_of_Hippo                |            2
 30786325585300 | Bob_Hope                          |            2
  2199023257601 | Canada                            |            2
 15393162799165 | Dmitry_Medvedev                   |            2
  2199023259874 | Franklin_D._Roosevelt             |            2
 15393162793184 | Interpol                          |            2
  2199023257601 | Jean-Baptiste_Lamarck             |            2
  2199023261968 | Johannes_Brahms                   |            2
 19791209309107 | John_Cage                         |            2
 19791209309107 | Leonard_Bernstein                 |            2
  2199023259874 | Ludwig_van_Beethoven              |            2
  4398046512280 | Muammar_Gaddafi                   |            2
  2199023257601 | Mughal_Empire                     |            2
 30786325581417 | Plácido_Domingo                   |            2
  2199023257601 | Slavoj_Žižek                      |            2
 30786325581417 | Wayne_Gretzky                     |            2
  2199023261968 | Wolfgang_Amadeus_Mozart           |            2
           9043 | 14th_Dalai_Lama                   |            1
  2199023257601 | 14th_Dalai_Lama                   |            1
  4398046512280 | 14th_Dalai_Lama                   |            1
            217 | 99_Luftballons                    |            1
 30786325585300 | A_Day_Without_Rain                |            1
 28587302322352 | A_Kind_of_Magic                   |            1
  2199023259874 | A_Little_Bit_Me,_a_Little_Bit_You |            1
           7684 | A_Whiter_Shade_of_Pale            |            1
 15393162793184 | Aaron_Copland                     |            1
 17592186053088 | Abbasid_Caliphate                 |            1
 32985348842018 | Adolf_Hitler                      |            1
            217 | Alan_Moore                        |            1
 19791209309107 | Albert_Einstein                   |            1
            217 | Alexander_Downer                  |            1
 19791209310154 | Alexander_Pushkin                 |            1
  4398046517288 | Alfred,_Lord_Tennyson             |            1
  2199023259874 | Alfred_Hitchcock                  |            1
           9043 | Ali                               |            1
  2199023257601 | Ali                               |            1
  4398046512280 | Ali                               |            1
 21990232560354 | Ali                               |            1
 21990232564061 | All_the_Roadrunning               |            1
 32985348842085 | Ammon                             |            1
           6079 | Andrew_Jackson                    |            1
 19791209309107 | Angola                            |            1
 30786325581056 | Another_One_Bites_the_Dust        |            1
  2199023257601 | Anton_Chekhov                     |            1
  4398046512280 | Are_You_Experienced               |            1
 21990232564061 | Arenberg                          |            1
            217 | Aristophanes                      |            1
  2199023259874 | Aristophanes                      |            1
 30786325585300 | Aristophanes                      |            1
           6079 | Aristotle                         |            1
 10995116279128 | Arnold_Schwarzenegger             |            1
 32985348842085 | Arthur_William_Baden_Powell       |            1
 19791209309107 | Ashikaga_shogunate                |            1
 30786325585300 | At_Last                           |            1
 28587302322352 | At_War_with_the_Mystics           |            1
 30786325581417 | Augustin_Pyramus_de_Candolle      |            1
 10995116285979 | Augustine_of_Hippo                |            1
 32985348842085 | Augustine_of_Hippo                |            1
           9043 | Austrian_Empire                   |            1
 19791209310154 | Banned_in_the_U.S.A.              |            1
  2199023257601 | Barbra_Streisand                  |            1
  2199023257601 | Barrio_Fino                       |            1
  2199023259874 | Barry_Manilow                     |            1
  2199023259874 | Before_You_Were_Punk              |            1
 30786325581417 | Benjamin_Harrison                 |            1
 30786325585300 | Bertolt_Brecht                    |            1
 19791209309107 | Bill_Clinton                      |            1
 30786325585300 | Bill_Clinton                      |            1
 32985348842018 | Blood_Sugar_Sex_Magik             |            1
  2199023257601 | Bob_Dole                          |            1
 19791209309107 | Bob_Dylan                         |            1
 32985348842085 | Botswana                          |            1
 10995116279128 | Break_Like_the_Wind               |            1
 30786325585300 | Breathe_Again                     |            1
 21990232564061 | British_Ceylon                    |            1
  2199023261968 | British_Empire                    |            1
  2199023257601 | Burma                             |            1
 19791209309107 | Busta_Rhymes                      |            1
 30786325581417 | Busta_Rhymes                      |            1
 30786325585300 | Béla_Bartók                       |            1
 19791209309107 | C._S._Lewis                       |            1
 21990232564061 | Cameroon                          |            1
 35184372093958 | Cannot_Buy_My_Soul                |            1
  2199023257601 | Cape_Verde                        |            1
 19791209310154 | Carl_Gustaf_Emil_Mannerheim       |            1
  4398046518779 | Chaka_Khan                        |            1
  2199023259874 | Champa                            |            1
           7684 | Charles_Dickens                   |            1
 32985348842085 | Charles_II_of_England             |            1
 30786325585300 | Charles_I_of_England              |            1
 15393162793184 | Charlton_Heston                   |            1
  4398046517288 | Che_Guevara                       |            1
 30786325581417 | Christopher_Columbus              |            1
  2199023257601 | Chrome_Dreams_II                  |            1
 10995116279128 | Claude_Debussy                    |            1
 10995116285979 | Claude_Debussy                    |            1
(100 rows)

Time: 4361.231 ms (00:04.361)
Q10 RUN 3
   person.id    |             tag.name              | messagecount 
----------------+-----------------------------------+--------------
  2199023257601 | Ralph_Vaughan_Williams            |            3
  2199023257601 | Aristophanes                      |            2
 15393162799165 | Aristophanes                      |            2
 19791209309107 | Aristophanes                      |            2
           6079 | Augustine_of_Hippo                |            2
 30786325585300 | Bob_Hope                          |            2
  2199023257601 | Canada                            |            2
 15393162799165 | Dmitry_Medvedev                   |            2
  2199023259874 | Franklin_D._Roosevelt             |            2
 15393162793184 | Interpol                          |            2
  2199023257601 | Jean-Baptiste_Lamarck             |            2
  2199023261968 | Johannes_Brahms                   |            2
 19791209309107 | John_Cage                         |            2
 19791209309107 | Leonard_Bernstein                 |            2
  2199023259874 | Ludwig_van_Beethoven              |            2
  4398046512280 | Muammar_Gaddafi                   |            2
  2199023257601 | Mughal_Empire                     |            2
 30786325581417 | Plácido_Domingo                   |            2
  2199023257601 | Slavoj_Žižek                      |            2
 30786325581417 | Wayne_Gretzky                     |            2
  2199023261968 | Wolfgang_Amadeus_Mozart           |            2
           9043 | 14th_Dalai_Lama                   |            1
  2199023257601 | 14th_Dalai_Lama                   |            1
  4398046512280 | 14th_Dalai_Lama                   |            1
            217 | 99_Luftballons                    |            1
 30786325585300 | A_Day_Without_Rain                |            1
 28587302322352 | A_Kind_of_Magic                   |            1
  2199023259874 | A_Little_Bit_Me,_a_Little_Bit_You |            1
           7684 | A_Whiter_Shade_of_Pale            |            1
 15393162793184 | Aaron_Copland                     |            1
 17592186053088 | Abbasid_Caliphate                 |            1
 32985348842018 | Adolf_Hitler                      |            1
            217 | Alan_Moore                        |            1
 19791209309107 | Albert_Einstein                   |            1
            217 | Alexander_Downer                  |            1
 19791209310154 | Alexander_Pushkin                 |            1
  4398046517288 | Alfred,_Lord_Tennyson             |            1
  2199023259874 | Alfred_Hitchcock                  |            1
           9043 | Ali                               |            1
  2199023257601 | Ali                               |            1
  4398046512280 | Ali                               |            1
 21990232560354 | Ali                               |            1
 21990232564061 | All_the_Roadrunning               |            1
 32985348842085 | Ammon                             |            1
           6079 | Andrew_Jackson                    |            1
 19791209309107 | Angola                            |            1
 30786325581056 | Another_One_Bites_the_Dust        |            1
  2199023257601 | Anton_Chekhov                     |            1
  4398046512280 | Are_You_Experienced               |            1
 21990232564061 | Arenberg                          |            1
            217 | Aristophanes                      |            1
  2199023259874 | Aristophanes                      |            1
 30786325585300 | Aristophanes                      |            1
           6079 | Aristotle                         |            1
 10995116279128 | Arnold_Schwarzenegger             |            1
 32985348842085 | Arthur_William_Baden_Powell       |            1
 19791209309107 | Ashikaga_shogunate                |            1
 30786325585300 | At_Last                           |            1
 28587302322352 | At_War_with_the_Mystics           |            1
 30786325581417 | Augustin_Pyramus_de_Candolle      |            1
 10995116285979 | Augustine_of_Hippo                |            1
 32985348842085 | Augustine_of_Hippo                |            1
           9043 | Austrian_Empire                   |            1
 19791209310154 | Banned_in_the_U.S.A.              |            1
  2199023257601 | Barbra_Streisand                  |            1
  2199023257601 | Barrio_Fino                       |            1
  2199023259874 | Barry_Manilow                     |            1
  2199023259874 | Before_You_Were_Punk              |            1
 30786325581417 | Benjamin_Harrison                 |            1
 30786325585300 | Bertolt_Brecht                    |            1
 19791209309107 | Bill_Clinton                      |            1
 30786325585300 | Bill_Clinton                      |            1
 32985348842018 | Blood_Sugar_Sex_Magik             |            1
  2199023257601 | Bob_Dole                          |            1
 19791209309107 | Bob_Dylan                         |            1
 32985348842085 | Botswana                          |            1
 10995116279128 | Break_Like_the_Wind               |            1
 30786325585300 | Breathe_Again                     |            1
 21990232564061 | British_Ceylon                    |            1
  2199023261968 | British_Empire                    |            1
  2199023257601 | Burma                             |            1
 19791209309107 | Busta_Rhymes                      |            1
 30786325581417 | Busta_Rhymes                      |            1
 30786325585300 | Béla_Bartók                       |            1
 19791209309107 | C._S._Lewis                       |            1
 21990232564061 | Cameroon                          |            1
 35184372093958 | Cannot_Buy_My_Soul                |            1
  2199023257601 | Cape_Verde                        |            1
 19791209310154 | Carl_Gustaf_Emil_Mannerheim       |            1
  4398046518779 | Chaka_Khan                        |            1
  2199023259874 | Champa                            |            1
           7684 | Charles_Dickens                   |            1
 32985348842085 | Charles_II_of_England             |            1
 30786325585300 | Charles_I_of_England              |            1
 15393162793184 | Charlton_Heston                   |            1
  4398046517288 | Che_Guevara                       |            1
 30786325581417 | Christopher_Columbus              |            1
  2199023257601 | Chrome_Dreams_II                  |            1
 10995116279128 | Claude_Debussy                    |            1
 10995116285979 | Claude_Debussy                    |            1
(100 rows)

Time: 4380.043 ms (00:04.380)

Q11 EXPLAINED
                                                                                           Optimized Plan                                                                                           
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Explained Query:                                                                                                                                                                                  +
   Return // { arity: 1 }                                                                                                                                                                          +
     Union // { arity: 1 }                                                                                                                                                                         +
       Get l2 // { arity: 1 }                                                                                                                                                                      +
       Map (0) // { arity: 1 }                                                                                                                                                                     +
         Union // { arity: 0 }                                                                                                                                                                     +
           Negate // { arity: 0 }                                                                                                                                                                  +
             Project () // { arity: 0 }                                                                                                                                                            +
               Get l2 // { arity: 1 }                                                                                                                                                              +
           Constant // { arity: 0 }                                                                                                                                                                +
             - ()                                                                                                                                                                                  +
   With                                                                                                                                                                                            +
     cte l2 =                                                                                                                                                                                      +
       Reduce aggregates=[count(*)] // { arity: 1 }                                                                                                                                                +
         Project () // { arity: 0 }                                                                                                                                                                +
           Join on=(#0{id} = #5{person2id} AND #1{person2id} = #2{id} AND #3{person2id} = #4{id}) type=differential // { arity: 6 }                                                                +
             implementation                                                                                                                                                                        +
               %0:l1[#1]Kf » %1:l1[#0]Kf » %2:l0[#0, #1]KKf                                                                                                                                        +
             ArrangeBy keys=[[#1{person2id}]] // { arity: 2 }                                                                                                                                      +
               Get l1 // { arity: 2 }                                                                                                                                                              +
             ArrangeBy keys=[[#0{id}]] // { arity: 2 }                                                                                                                                             +
               Get l1 // { arity: 2 }                                                                                                                                                              +
             ArrangeBy keys=[[#0{id}, #1{person2id}]] // { arity: 2 }                                                                                                                              +
               Get l0 // { arity: 2 }                                                                                                                                                              +
     cte l1 =                                                                                                                                                                                      +
       Filter (#0{id} < #1{person2id}) // { arity: 2 }                                                                                                                                             +
         Get l0 // { arity: 2 }                                                                                                                                                                    +
     cte l0 =                                                                                                                                                                                      +
       Project (#1, #21) // { arity: 2 }                                                                                                                                                           +
         Filter (#16{name} = "India") AND (#19{creationdate} <= 2013-01-10 00:00:00 UTC) AND (2012-09-28 00:00:00 UTC <= #19{creationdate}) AND (#14{partofcountryid}) IS NOT NULL // { arity: 22 }+
           Join on=(#1{id} = #20{person1id} AND #8{locationcityid} = #11{id} AND #14{partofcountryid} = #15{id}) type=delta // { arity: 22 }                                                       +
             implementation                                                                                                                                                                        +
               %0:person » %3:person_knows_person[#1]KAiif » %1:city[#0]KA » %2:country[#0]KAef                                                                                                    +
               %1:city » %2:country[#0]KAef » %0:person[#8]KA » %3:person_knows_person[#1]KAiif                                                                                                    +
               %2:country » %1:city[#3]KA » %0:person[#8]KA » %3:person_knows_person[#1]KAiif                                                                                                      +
               %3:person_knows_person » %0:person[#1]KA » %1:city[#0]KA » %2:country[#0]KAef                                                                                                       +
             ArrangeBy keys=[[#1{id}], [#8{locationcityid}]] // { arity: 11 }                                                                                                                      +
               ReadIndex on=person person_id=[delta join 1st input (full scan)] person_locationcityid=[delta join 1st input (full scan)] // { arity: 11 }                                          +
             ArrangeBy keys=[[#0{id}], [#3{partofcountryid}]] // { arity: 4 }                                                                                                                      +
               ReadIndex on=city city_id=[delta join lookup] city_partofcountryid=[delta join lookup] // { arity: 4 }                                                                              +
             ArrangeBy keys=[[#0{id}]] // { arity: 4 }                                                                                                                                             +
               ReadIndex on=country country_id=[delta join lookup] // { arity: 4 }                                                                                                                 +
             ArrangeBy keys=[[#1{person1id}]] // { arity: 3 }                                                                                                                                      +
               ReadIndex on=person_knows_person person_knows_person_person1id=[delta join lookup] // { arity: 3 }                                                                                  +
                                                                                                                                                                                                   +
 Used Indexes:                                                                                                                                                                                     +
   - materialize.public.person_id (delta join 1st input (full scan))                                                                                                                               +
   - materialize.public.person_locationcityid (delta join 1st input (full scan))                                                                                                                   +
   - materialize.public.person_knows_person_person1id (delta join lookup)                                                                                                                          +
   - materialize.public.country_id (delta join lookup)                                                                                                                                             +
   - materialize.public.city_id (delta join lookup)                                                                                                                                                +
   - materialize.public.city_partofcountryid (delta join lookup)                                                                                                                                   +
 
(1 row)

Time: 26.464 ms
Q11 RUN 1
 count 
-------
   840
(1 row)

Time: 180.673 ms
Q11 RUN 2
 count 
-------
   840
(1 row)

Time: 171.101 ms
Q11 RUN 3
 count 
-------
   840
(1 row)

Time: 211.592 ms

Q15 EXPLAINED
                                                                                              Optimized Plan                                                                                              
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Explained Query:                                                                                                                                                                                        +
   Finish order_by=[#1 asc nulls_last] limit=20 output=[#2]                                                                                                                                              +
     Return // { arity: 3 }                                                                                                                                                                              +
       Project (#1, #2, #2) // { arity: 3 }                                                                                                                                                              +
         Filter (#1{person2id} = 15393162796819) AND (#2 = #2) // { arity: 3 }                                                                                                                           +
           Get l4 // { arity: 3 }                                                                                                                                                                        +
     With Mutually Recursive                                                                                                                                                                             +
       cte l4 =                                                                                                                                                                                          +
         Project (#2, #0, #1) // { arity: 3 }                                                                                                                                                            +
           Map (1450) // { arity: 3 }                                                                                                                                                                    +
             Reduce group_by=[#0{person2id}] aggregates=[min(#1)] // { arity: 2 }                                                                                                                        +
               Distinct project=[#0{person2id}, #1] // { arity: 2 }                                                                                                                                      +
                 Union // { arity: 2 }                                                                                                                                                                   +
                   Project (#3, #5) // { arity: 2 }                                                                                                                                                      +
                     Map ((#1 + #4)) // { arity: 6 }                                                                                                                                                     +
                       Join on=(#0 = #2{person1id}) type=differential // { arity: 5 }                                                                                                                    +
                         implementation                                                                                                                                                                  +
                           %0:l4[#0]K » %1[#0]K                                                                                                                                                          +
                         ArrangeBy keys=[[#0]] // { arity: 2 }                                                                                                                                           +
                           Project (#1, #2) // { arity: 2 }                                                                                                                                              +
                             Get l4 // { arity: 3 }                                                                                                                                                      +
                         ArrangeBy keys=[[#0{person1id}]] // { arity: 3 }                                                                                                                                +
                           Project (#0, #1, #3) // { arity: 3 }                                                                                                                                          +
                             Map ((10 / bigint_to_double((coalesce(#2, 0) + 10)))) // { arity: 4 }                                                                                                       +
                               Union // { arity: 3 }                                                                                                                                                     +
                                 Map (null) // { arity: 3 }                                                                                                                                              +
                                   Union // { arity: 2 }                                                                                                                                                 +
                                     Negate // { arity: 2 }                                                                                                                                              +
                                       Project (#0, #1) // { arity: 2 }                                                                                                                                  +
                                         Join on=(#2 = least(#0{person1id}, #1{person2id}) AND #3 = greatest(#0{person1id}, #1{person2id})) type=differential // { arity: 4 }                            +
                                           implementation                                                                                                                                                +
                                             %1[#1, #0]UKK » %0:l3[greatest(#0, #1), least(#0, #1)]KK                                                                                                    +
                                           ArrangeBy keys=[[greatest(#0{person1id}, #1{person2id}), least(#0{person1id}, #1{person2id})]] // { arity: 2 }                                                +
                                             Get l3 // { arity: 2 }                                                                                                                                      +
                                           ArrangeBy keys=[[#1, #0]] // { arity: 2 }                                                                                                                     +
                                             Distinct project=[least(#0{person1id}, #1{person2id}), greatest(#0{person1id}, #1{person2id})] // { arity: 2 }                                              +
                                               Project (#0, #1) // { arity: 2 }                                                                                                                          +
                                                 Get l2 // { arity: 3 }                                                                                                                                  +
                                     Get l3 // { arity: 2 }                                                                                                                                              +
                                 Get l2 // { arity: 3 }                                                                                                                                                  +
                   Constant // { arity: 2 }                                                                                                                                                              +
                     - (1450, 0)                                                                                                                                                                         +
       cte l3 =                                                                                                                                                                                          +
         Project (#1, #2) // { arity: 2 }                                                                                                                                                                +
           ReadIndex on=person_knows_person person_knows_person_person1id=[*** full scan ***] // { arity: 3 }                                                                                            +
       cte l2 =                                                                                                                                                                                          +
         Project (#0, #1, #4) // { arity: 3 }                                                                                                                                                            +
           Join on=(#2 = least(#0{person1id}, #1{person2id}) AND #3 = greatest(#0{person1id}, #1{person2id})) type=differential // { arity: 5 }                                                          +
             implementation                                                                                                                                                                              +
               %1[#1, #0]UKK » %0:person_knows_person[greatest(#0, #1), least(#0, #1)]KK                                                                                                                 +
             ArrangeBy keys=[[greatest(#0{person1id}, #1{person2id}), least(#0{person1id}, #1{person2id})]] // { arity: 2 }                                                                              +
               Project (#1, #2) // { arity: 2 }                                                                                                                                                          +
                 ReadIndex on=person_knows_person person_knows_person_person1id=[*** full scan ***] // { arity: 3 }                                                                                      +
             ArrangeBy keys=[[#1, #0]] // { arity: 3 }                                                                                                                                                   +
               Reduce group_by=[least(#0{person1id}, #1{person2id}), greatest(#0{person1id}, #1{person2id})] aggregates=[sum(case when (#2{parentmessageid}) IS NULL then 10 else 5 end)] // { arity: 3 }+
                 Project (#0..=#2) // { arity: 3 }                                                                                                                                                       +
                   Join on=(#3{containerforumid} = #4{containerforumid} = #5{id}) type=delta // { arity: 6 }                                                                                             +
                     implementation                                                                                                                                                                      +
                       %0:l1 » %1[#0]UKA » %2[#0]UKA                                                                                                                                                     +
                       %1 » %2[#0]UKA » %0:l1[#3]KA                                                                                                                                                      +
                       %2 » %1[#0]UKA » %0:l1[#3]KA                                                                                                                                                      +
                     ArrangeBy keys=[[#3{containerforumid}]] // { arity: 4 }                                                                                                                             +
                       Get l1 // { arity: 4 }                                                                                                                                                            +
                     ArrangeBy keys=[[#0{containerforumid}]] // { arity: 1 }                                                                                                                             +
                       Distinct project=[#0{containerforumid}] // { arity: 1 }                                                                                                                           +
                         Project (#3) // { arity: 1 }                                                                                                                                                    +
                           Filter (#3{containerforumid}) IS NOT NULL // { arity: 4 }                                                                                                                     +
                             Get l1 // { arity: 4 }                                                                                                                                                      +
                     ArrangeBy keys=[[#0{id}]] // { arity: 1 }                                                                                                                                           +
                       Distinct project=[#0{id}] // { arity: 1 }                                                                                                                                         +
                         Project (#1) // { arity: 1 }                                                                                                                                                    +
                           Filter (#0{creationdate} <= 2012-11-10 00:00:00 UTC) AND (#0{creationdate} >= 2012-11-06 00:00:00 UTC) // { arity: 4 }                                                        +
                             ReadIndex on=forum forum_id=[*** full scan ***] // { arity: 4 }                                                                                                             +
       cte l1 =                                                                                                                                                                                          +
         Project (#0, #1, #3, #4) // { arity: 4 }                                                                                                                                                        +
           Join on=(#2{containerforumid} = #5{containerforumid} = #6{id}) type=delta // { arity: 7 }                                                                                                     +
             implementation                                                                                                                                                                              +
               %0:l0 » %1[#0]UKA » %2[#0]UKA                                                                                                                                                             +
               %1 » %2[#0]UKA » %0:l0[#2]KA                                                                                                                                                              +
               %2 » %1[#0]UKA » %0:l0[#2]KA                                                                                                                                                              +
             ArrangeBy keys=[[#2{containerforumid}]] // { arity: 5 }                                                                                                                                     +
               Get l0 // { arity: 5 }                                                                                                                                                                    +
             ArrangeBy keys=[[#0{containerforumid}]] // { arity: 1 }                                                                                                                                     +
               Distinct project=[#0{containerforumid}] // { arity: 1 }                                                                                                                                   +
                 Project (#2) // { arity: 1 }                                                                                                                                                            +
                   Filter (#2{containerforumid}) IS NOT NULL // { arity: 5 }                                                                                                                             +
                     Get l0 // { arity: 5 }                                                                                                                                                              +
             ArrangeBy keys=[[#0{id}]] // { arity: 1 }                                                                                                                                                   +
               Distinct project=[#0{id}] // { arity: 1 }                                                                                                                                                 +
                 Project (#1) // { arity: 1 }                                                                                                                                                            +
                   Filter (#0{creationdate} <= 2012-11-10 00:00:00 UTC) AND (#0{creationdate} >= 2012-11-06 00:00:00 UTC) // { arity: 4 }                                                                +
                     ReadIndex on=forum forum_id=[*** full scan ***] // { arity: 4 }                                                                                                                     +
       cte l0 =                                                                                                                                                                                          +
         Project (#1, #2, #13, #15, #17) // { arity: 5 }                                                                                                                                                 +
           Join on=(#1{person1id} = #12{creatorpersonid} AND #2{person2id} = #16{creatorpersonid} AND #4{messageid} = #18{parentmessageid}) type=differential // { arity: 19 }                           +
             implementation                                                                                                                                                                              +
               %0:person_knows_person[#1]KA » %1:message[#9]KA » %2:message[#0, #2]KK                                                                                                                    +
             ArrangeBy keys=[[#1{person1id}]] // { arity: 3 }                                                                                                                                            +
               ReadIndex on=person_knows_person person_knows_person_person1id=[differential join] // { arity: 3 }                                                                                        +
             ArrangeBy keys=[[#9{creatorpersonid}]] // { arity: 13 }                                                                                                                                     +
               ReadIndex on=message message_creatorpersonid=[differential join] // { arity: 13 }                                                                                                         +
             ArrangeBy keys=[[#0{creatorpersonid}, #2{parentmessageid}]] // { arity: 3 }                                                                                                                 +
               Project (#9, #10, #12) // { arity: 3 }                                                                                                                                                    +
                 Filter (#12{parentmessageid}) IS NOT NULL // { arity: 13 }                                                                                                                              +
                   ReadIndex on=message message_creatorpersonid=[*** full scan ***] // { arity: 13 }                                                                                                     +
                                                                                                                                                                                                         +
 Used Indexes:                                                                                                                                                                                           +
   - materialize.public.forum_id (*** full scan ***)                                                                                                                                                     +
   - materialize.public.person_knows_person_person1id (*** full scan ***, differential join)                                                                                                             +
   - materialize.public.message_creatorpersonid (*** full scan ***, differential join)                                                                                                                   +
 
(1 row)

Time: 40.791 ms
Time: 11.205 ms
Q15 RUN 1
 coalesce 
----------
        4
(1 row)

Time: 162699.203 ms (02:42.699)
Time: 12.045 ms
Q15 RUN 2
 coalesce 
----------
        4
(1 row)

Time: 163532.754 ms (02:43.533)
Time: 11.224 ms
Q15 RUN 3
 coalesce 
----------
        4
(1 row)

Time: 162919.833 ms (02:42.920)
Time: 10.663 ms

Q16 EXPLAINED
                                                                         Optimized Plan                                                                         
----------------------------------------------------------------------------------------------------------------------------------------------------------------
 Explained Query:                                                                                                                                              +
   Finish order_by=[#6 desc nulls_first, #0{id} asc nulls_last] limit=20 output=[#0, #1, #4]                                                                   +
     Return // { arity: 7 }                                                                                                                                    +
       Project (#0..=#2, #0, #4..=#6) // { arity: 7 }                                                                                                          +
         Filter (#2 <= 5) AND (#5 <= 5) // { arity: 7 }                                                                                                        +
           Map ((#1 + #4)) // { arity: 7 }                                                                                                                     +
             Join on=(#0{id} = #3{id}) type=differential // { arity: 6 }                                                                                       +
               implementation                                                                                                                                  +
                 %0[#0]UKAif » %1[#0]UKAiif                                                                                                                    +
               ArrangeBy keys=[[#0{id}]] // { arity: 3 }                                                                                                       +
                 Reduce group_by=[#0{id}] aggregates=[count(distinct #1{messageid}), count(distinct #2{person2id})] // { arity: 3 }                            +
                   Union // { arity: 3 }                                                                                                                       +
                     Get l5 // { arity: 3 }                                                                                                                    +
                     Map (null) // { arity: 3 }                                                                                                                +
                       Union // { arity: 2 }                                                                                                                   +
                         Negate // { arity: 2 }                                                                                                                +
                           Distinct project=[#0{id}, #1{messageid}] // { arity: 2 }                                                                            +
                             Project (#0, #1) // { arity: 2 }                                                                                                  +
                               Get l5 // { arity: 3 }                                                                                                          +
                         Get l3 // { arity: 2 }                                                                                                                +
               ArrangeBy keys=[[#0{id}]] // { arity: 3 }                                                                                                       +
                 Reduce group_by=[#0{id}] aggregates=[count(distinct #1{messageid}), count(distinct #2{person2id})] // { arity: 3 }                            +
                   Union // { arity: 3 }                                                                                                                       +
                     Get l7 // { arity: 3 }                                                                                                                    +
                     Map (null) // { arity: 3 }                                                                                                                +
                       Union // { arity: 2 }                                                                                                                   +
                         Negate // { arity: 2 }                                                                                                                +
                           Distinct project=[#0{id}, #1{messageid}] // { arity: 2 }                                                                            +
                             Project (#0, #1) // { arity: 2 }                                                                                                  +
                               Get l7 // { arity: 3 }                                                                                                          +
                         Get l6 // { arity: 2 }                                                                                                                +
     With                                                                                                                                                      +
       cte l7 =                                                                                                                                                +
         Project (#0, #1, #4) // { arity: 3 }                                                                                                                  +
           Join on=(#0{id} = #3{person1id} AND #4{person2id} = #5{id}) type=delta // { arity: 6 }                                                              +
             implementation                                                                                                                                    +
               %0:l6 » %1:l4[#1]KA » %2[#0]UKA                                                                                                                 +
               %1:l4 » %2[#0]UKA » %0:l6[#0]KA                                                                                                                 +
               %2 » %1:l4[#2]KA » %0:l6[#0]KA                                                                                                                  +
             ArrangeBy keys=[[#0{id}]] // { arity: 2 }                                                                                                         +
               Get l6 // { arity: 2 }                                                                                                                          +
             Get l4 // { arity: 3 }                                                                                                                            +
             ArrangeBy keys=[[#0{id}]] // { arity: 1 }                                                                                                         +
               Distinct project=[#0{id}] // { arity: 1 }                                                                                                       +
                 Project (#0) // { arity: 1 }                                                                                                                  +
                   Get l6 // { arity: 2 }                                                                                                                      +
       cte l6 =                                                                                                                                                +
         Project (#0, #2) // { arity: 2 }                                                                                                                      +
           Join on=(#0{id} = #1{creatorpersonid} AND #2{messageid} = #3{messageid}) type=differential // { arity: 4 }                                          +
             implementation                                                                                                                                    +
               %0:l0[#0]UKA » %1[#0]K » %2[#0]UKA                                                                                                              +
             Get l0 // { arity: 1 }                                                                                                                            +
             ArrangeBy keys=[[#0{creatorpersonid}]] // { arity: 2 }                                                                                            +
               Distinct project=[#1{creatorpersonid}, #0{messageid}] // { arity: 2 }                                                                           +
                 Project (#1, #9) // { arity: 2 }                                                                                                              +
                   Filter (2012-12-14 00:00:00 = date_to_timestamp(timestamp_with_time_zone_to_date(#0{creationdate}))) // { arity: 13 }                       +
                     ReadIndex on=message message_messageid=[*** full scan ***] // { arity: 13 }                                                               +
             ArrangeBy keys=[[#0{messageid}]] // { arity: 1 }                                                                                                  +
               Distinct project=[#0{messageid}] // { arity: 1 }                                                                                                +
                 Project (#1) // { arity: 1 }                                                                                                                  +
                   Join on=(#2{tagid} = #3{id}) type=differential // { arity: 8 }                                                                              +
                     implementation                                                                                                                            +
                       %1:tag[#0]KAe » %0:l1[#2]KAe                                                                                                            +
                     Get l1 // { arity: 3 }                                                                                                                    +
                     ArrangeBy keys=[[#0{id}]] // { arity: 5 }                                                                                                 +
                       ReadIndex on=materialize.public.tag tag_name=[lookup value=("Thailand_Noriega")] // { arity: 5 }                                        +
       cte l5 =                                                                                                                                                +
         Project (#0, #1, #4) // { arity: 3 }                                                                                                                  +
           Join on=(#0{id} = #3{person1id} AND #4{person2id} = #5{id}) type=delta // { arity: 6 }                                                              +
             implementation                                                                                                                                    +
               %0:l3 » %1:l4[#1]KA » %2[#0]UKA                                                                                                                 +
               %1:l4 » %2[#0]UKA » %0:l3[#0]KA                                                                                                                 +
               %2 » %1:l4[#2]KA » %0:l3[#0]KA                                                                                                                  +
             ArrangeBy keys=[[#0{id}]] // { arity: 2 }                                                                                                         +
               Get l3 // { arity: 2 }                                                                                                                          +
             Get l4 // { arity: 3 }                                                                                                                            +
             ArrangeBy keys=[[#0{id}]] // { arity: 1 }                                                                                                         +
               Distinct project=[#0{id}] // { arity: 1 }                                                                                                       +
                 Project (#0) // { arity: 1 }                                                                                                                  +
                   Get l3 // { arity: 2 }                                                                                                                      +
       cte l4 =                                                                                                                                                +
         ArrangeBy keys=[[#1{person1id}], [#2{person2id}]] // { arity: 3 }                                                                                     +
           ReadIndex on=person_knows_person person_knows_person_person1id=[delta join lookup] person_knows_person_person2id=[delta join lookup] // { arity: 3 }+
       cte l3 =                                                                                                                                                +
         Project (#0, #2) // { arity: 2 }                                                                                                                      +
           Join on=(#0{id} = #1{creatorpersonid} AND #2{messageid} = #3{messageid}) type=differential // { arity: 4 }                                          +
             implementation                                                                                                                                    +
               %0:l0[#0]UKA » %1[#0]K » %2[#0]UKA                                                                                                              +
             Get l0 // { arity: 1 }                                                                                                                            +
             ArrangeBy keys=[[#0{creatorpersonid}]] // { arity: 2 }                                                                                            +
               Distinct project=[#1{creatorpersonid}, #0{messageid}] // { arity: 2 }                                                                           +
                 Project (#1, #9) // { arity: 2 }                                                                                                              +
                   Filter (2012-10-07 00:00:00 = date_to_timestamp(timestamp_with_time_zone_to_date(#0{creationdate}))) // { arity: 13 }                       +
                     ReadIndex on=message message_messageid=[*** full scan ***] // { arity: 13 }                                                               +
             ArrangeBy keys=[[#0{messageid}]] // { arity: 1 }                                                                                                  +
               Distinct project=[#0{messageid}] // { arity: 1 }                                                                                                +
                 Project (#1) // { arity: 1 }                                                                                                                  +
                   Join on=(#2{tagid} = #3{id}) type=differential // { arity: 8 }                                                                              +
                     implementation                                                                                                                            +
                       %1:tag[#0]KAe » %0:l1[#2]KAe                                                                                                            +
                     Get l1 // { arity: 3 }                                                                                                                    +
                     ArrangeBy keys=[[#0{id}]] // { arity: 5 }                                                                                                 +
                       ReadIndex on=materialize.public.tag tag_name=[lookup value=("Diosdado_Macapagal")] // { arity: 5 }                                      +
       cte l2 =                                                                                                                                                +
         ArrangeBy keys=[[#1{name}]] // { arity: 4 }                                                                                                           +
           ReadIndex on=tag tag_name=[lookup] // { arity: 4 }                                                                                                  +
       cte l1 =                                                                                                                                                +
         ArrangeBy keys=[[#2{tagid}]] // { arity: 3 }                                                                                                          +
           ReadIndex on=message_hastag_tag message_hastag_tag_tagid=[differential join] // { arity: 3 }                                                        +
       cte l0 =                                                                                                                                                +
         ArrangeBy keys=[[#0{id}]] // { arity: 1 }                                                                                                             +
           Distinct project=[#0{id}] // { arity: 1 }                                                                                                           +
             Project (#1) // { arity: 1 }                                                                                                                      +
               ReadIndex on=person person_id=[*** full scan ***] // { arity: 11 }                                                                              +
                                                                                                                                                               +
 Used Indexes:                                                                                                                                                 +
   - materialize.public.tag_name (lookup)                                                                                                                      +
   - materialize.public.person_id (*** full scan ***)                                                                                                          +
   - materialize.public.person_knows_person_person1id (delta join lookup)                                                                                      +
   - materialize.public.person_knows_person_person2id (delta join lookup)                                                                                      +
   - materialize.public.message_hastag_tag_tagid (differential join)                                                                                           +
   - materialize.public.message_messageid (*** full scan ***)                                                                                                  +
 
(1 row)

Time: 42.155 ms
Q16 RUN 1
 personid | messagecounta | messagecountb 
----------+---------------+---------------
(0 rows)

Time: 1011.818 ms (00:01.012)
Q16 RUN 2
 personid | messagecounta | messagecountb 
----------+---------------+---------------
(0 rows)

Time: 981.423 ms
Q16 RUN 3
 personid | messagecounta | messagecountb 
----------+---------------+---------------
(0 rows)

Time: 987.632 ms

Q17 EXPLAINED
                                                                                                           Optimized Plan                                                                                                            
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Explained Query:                                                                                                                                                                                                                   +
   Finish order_by=[#1 desc nulls_first, #0{creatorpersonid} asc nulls_last] limit=10 output=[#0, #1]                                                                                                                               +
     Return // { arity: 2 }                                                                                                                                                                                                         +
       Reduce group_by=[#0{creatorpersonid}] aggregates=[count(distinct #1{messageid})] // { arity: 2 }                                                                                                                             +
         Project (#0, #1) // { arity: 2 }                                                                                                                                                                                           +
           Join on=(#0{creatorpersonid} = #3{creatorpersonid} AND #2{containerforumid} = #4{containerforumid}) type=differential // { arity: 5 }                                                                                    +
             implementation                                                                                                                                                                                                         +
               %0:l2[#0, #2]KK » %1[#0, #1]KK                                                                                                                                                                                       +
             ArrangeBy keys=[[#0{creatorpersonid}, #2{containerforumid}]] // { arity: 3 }                                                                                                                                           +
               Get l2 // { arity: 3 }                                                                                                                                                                                               +
             ArrangeBy keys=[[#0{creatorpersonid}, #1{containerforumid}]] // { arity: 2 }                                                                                                                                           +
               Union // { arity: 2 }                                                                                                                                                                                                +
                 Negate // { arity: 2 }                                                                                                                                                                                             +
                   Project (#0, #1) // { arity: 2 }                                                                                                                                                                                 +
                     Join on=(#0{creatorpersonid} = #2{personid} AND #1{containerforumid} = #3{forumid}) type=differential // { arity: 4 }                                                                                          +
                       implementation                                                                                                                                                                                               +
                         %0:l3[#0, #1]UKKA » %1[#0, #1]UKKA                                                                                                                                                                         +
                       ArrangeBy keys=[[#0{creatorpersonid}, #1{containerforumid}]] // { arity: 2 }                                                                                                                                 +
                         Get l3 // { arity: 2 }                                                                                                                                                                                     +
                       ArrangeBy keys=[[#0{personid}, #1{forumid}]] // { arity: 2 }                                                                                                                                                 +
                         Distinct project=[#1{personid}, #0{forumid}] // { arity: 2 }                                                                                                                                               +
                           Project (#1, #2) // { arity: 2 }                                                                                                                                                                         +
                             ReadIndex on=forum_hasmember_person forum_hasmember_person_forumid=[*** full scan ***] // { arity: 3 }                                                                                                 +
                 Get l3 // { arity: 2 }                                                                                                                                                                                             +
     With                                                                                                                                                                                                                           +
       cte l3 =                                                                                                                                                                                                                     +
         Distinct project=[#0{creatorpersonid}, #1{containerforumid}] // { arity: 2 }                                                                                                                                               +
           Project (#0, #2) // { arity: 2 }                                                                                                                                                                                         +
             Get l2 // { arity: 3 }                                                                                                                                                                                                 +
       cte l2 =                                                                                                                                                                                                                     +
         Project (#1, #4, #6) // { arity: 3 }                                                                                                                                                                                       +
           Filter (#2{containerforumid} != #6{containerforumid}) AND (#5{creatorpersonid} != #7{creatorpersonid}) AND ((#0{creationdate} + 12:00:00) < #3{creationdate}) // { arity: 15 }                                           +
             Join on=(#2{containerforumid} = #10{forumid} = #13{forumid} AND #4{messageid} = #8{parentmessageid} AND #5{creatorpersonid} = #14{personid} AND #7{creatorpersonid} = #11{personid}) type=differential // { arity: 15 }+
               implementation                                                                                                                                                                                                       +
                 %3:l1[#1]KA » %4:l1[#1]KA » %0:l0[#2]K » %1:l0[#2]K » %2:l0[#0, #1]KK                                                                                                                                              +
               ArrangeBy keys=[[#2{containerforumid}]] // { arity: 3 }                                                                                                                                                              +
                 Project (#0, #2, #3) // { arity: 3 }                                                                                                                                                                               +
                   Filter (#3{containerforumid}) IS NOT NULL // { arity: 5 }                                                                                                                                                        +
                     Get l0 // { arity: 5 }                                                                                                                                                                                         +
               ArrangeBy keys=[[#2{creatorpersonid}]] // { arity: 4 }                                                                                                                                                               +
                 Project (#0..=#3) // { arity: 4 }                                                                                                                                                                                  +
                   Get l0 // { arity: 5 }                                                                                                                                                                                           +
               ArrangeBy keys=[[#0{creatorpersonid}, #1{parentmessageid}]] // { arity: 2 }                                                                                                                                          +
                 Project (#2, #4) // { arity: 2 }                                                                                                                                                                                   +
                   Filter (#4{parentmessageid}) IS NOT NULL // { arity: 5 }                                                                                                                                                         +
                     Get l0 // { arity: 5 }                                                                                                                                                                                         +
               Get l1 // { arity: 3 }                                                                                                                                                                                               +
               Get l1 // { arity: 3 }                                                                                                                                                                                               +
       cte l1 =                                                                                                                                                                                                                     +
         ArrangeBy keys=[[#1{forumid}]] // { arity: 3 }                                                                                                                                                                             +
           ReadIndex on=forum_hasmember_person forum_hasmember_person_forumid=[differential join] // { arity: 3 }                                                                                                                   +
       cte l0 =                                                                                                                                                                                                                     +
         Project (#0, #1, #9, #10, #12) // { arity: 5 }                                                                                                                                                                             +
           Join on=(#1{messageid} = #13{messageid}) type=differential // { arity: 14 }                                                                                                                                              +
             implementation                                                                                                                                                                                                         +
               %1[#0]UKA » %0:message[#1]KA                                                                                                                                                                                         +
             ArrangeBy keys=[[#1{messageid}]] // { arity: 13 }                                                                                                                                                                      +
               ReadIndex on=message message_messageid=[differential join] // { arity: 13 }                                                                                                                                          +
             ArrangeBy keys=[[#0{messageid}]] // { arity: 1 }                                                                                                                                                                       +
               Distinct project=[#0{messageid}] // { arity: 1 }                                                                                                                                                                     +
                 Project (#1) // { arity: 1 }                                                                                                                                                                                       +
                   Join on=(#2{tagid} = #3{id}) type=differential // { arity: 4 }                                                                                                                                                   +
                     implementation                                                                                                                                                                                                 +
                       %1[#0]UKA » %0:message_hastag_tag[#2]KA                                                                                                                                                                      +
                     ArrangeBy keys=[[#2{tagid}]] // { arity: 3 }                                                                                                                                                                   +
                       ReadIndex on=message_hastag_tag message_hastag_tag_tagid=[differential join] // { arity: 3 }                                                                                                                 +
                     ArrangeBy keys=[[#0{id}]] // { arity: 1 }                                                                                                                                                                      +
                       Distinct project=[#0{id}] // { arity: 1 }                                                                                                                                                                    +
                         Project (#0) // { arity: 1 }                                                                                                                                                                               +
                           ReadIndex on=materialize.public.tag tag_name=[lookup value=("Cosmic_Egg")] // { arity: 5 }                                                                                                               +
                                                                                                                                                                                                                                    +
 Used Indexes:                                                                                                                                                                                                                      +
   - materialize.public.tag_name (lookup)                                                                                                                                                                                           +
   - materialize.public.forum_hasmember_person_forumid (*** full scan ***, differential join)                                                                                                                                       +
   - materialize.public.message_hastag_tag_tagid (differential join)                                                                                                                                                                +
   - materialize.public.message_messageid (differential join)                                                                                                                                                                       +
 
(1 row)

Time: 32.710 ms
Q17 RUN 1
 person1.id | messagecount 
------------+--------------
(0 rows)

Time: 99799.048 ms (01:39.799)
Q17 RUN 2
 person1.id | messagecount 
------------+--------------
(0 rows)

Time: 104080.526 ms (01:44.081)
Q17 RUN 3
 person1.id | messagecount 
------------+--------------
(0 rows)

Time: 102711.980 ms (01:42.712)

Q18 EXPLAINED
                                                                                                                  Optimized Plan                                                                                                                   
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 materialize.public.pathq19:                                                                                                                                                                                                                      +
   Return // { arity: 3 }                                                                                                                                                                                                                         +
     Union // { arity: 3 }                                                                                                                                                                                                                        +
       Get l0 // { arity: 3 }                                                                                                                                                                                                                     +
       Project (#1, #0, #2) // { arity: 3 }                                                                                                                                                                                                       +
         Get l0 // { arity: 3 }                                                                                                                                                                                                                   +
   With                                                                                                                                                                                                                                           +
     cte l0 =                                                                                                                                                                                                                                     +
       Project (#0, #1, #3) // { arity: 3 }                                                                                                                                                                                                       +
         Map (greatest(f64toi64(roundf64((40 - sqrtf64(bigint_to_double(#2))))), 1)) // { arity: 4 }                                                                                                                                              +
           Reduce group_by=[#0{person1id}, #1{person2id}] aggregates=[count(*)] // { arity: 3 }                                                                                                                                                   +
             Project (#27, #28) // { arity: 2 }                                                                                                                                                                                                   +
               Filter (#12{parentmessageid}) IS NOT NULL AND (#9{creatorpersonid} != #22{creatorpersonid}) AND (#27{person1id} < #28{person2id}) // { arity: 29 }                                                                                 +
                 Join on=(#12{parentmessageid} = #14{messageid} AND #27{person1id} = least(#9{creatorpersonid}, #22{creatorpersonid}) AND #28{person2id} = greatest(#9{creatorpersonid}, #22{creatorpersonid})) type=differential // { arity: 29 }+
                   implementation                                                                                                                                                                                                                 +
                     %0:message[#12]KA » %1:message[#1]KA » %2:person_knows_person[#1, #2]KKAf                                                                                                                                                    +
                   ArrangeBy keys=[[#12{parentmessageid}]] // { arity: 13 }                                                                                                                                                                       +
                     ReadIndex on=message message_parentmessageid=[differential join] // { arity: 13 }                                                                                                                                            +
                   ArrangeBy keys=[[#1{messageid}]] // { arity: 13 }                                                                                                                                                                              +
                     ReadIndex on=message message_messageid=[differential join] // { arity: 13 }                                                                                                                                                  +
                   ArrangeBy keys=[[#1{person1id}, #2{person2id}]] // { arity: 3 }                                                                                                                                                                +
                     ReadIndex on=person_knows_person person_knows_person_person1id_person2id=[differential join] // { arity: 3 }                                                                                                                 +
                                                                                                                                                                                                                                                  +
 Used Indexes:                                                                                                                                                                                                                                    +
   - materialize.public.person_knows_person_person1id_person2id (differential join)                                                                                                                                                               +
   - materialize.public.message_messageid (differential join)                                                                                                                                                                                     +
   - materialize.public.message_parentmessageid (differential join)                                                                                                                                                                               +
 
(1 row)

Time: 20.386 ms
CREATE MATERIALIZED VIEW
Time: 590.458 ms
CREATE INDEX
Time: 661.265 ms
                                                    Optimized Plan                                                     
-----------------------------------------------------------------------------------------------------------------------
 Explained Query:                                                                                                     +
   Return // { arity: 3 }                                                                                             +
     Return // { arity: 3 }                                                                                           +
       Project (#0..=#2) // { arity: 3 }                                                                              +
         Join on=(#2 = #3) type=differential // { arity: 4 }                                                          +
           implementation                                                                                             +
             %1[#0]UK » %0:l1[#2]K                                                                                    +
           ArrangeBy keys=[[#2]] // { arity: 3 }                                                                      +
             Filter (#2) IS NOT NULL // { arity: 3 }                                                                  +
               Get l1 // { arity: 3 }                                                                                 +
           ArrangeBy keys=[[#0]] // { arity: 1 }                                                                      +
             Filter (#0) IS NOT NULL // { arity: 1 }                                                                  +
               Reduce aggregates=[min(#0)] // { arity: 1 }                                                            +
                 Project (#2) // { arity: 1 }                                                                         +
                   Get l1 // { arity: 3 }                                                                             +
     With                                                                                                             +
       cte l1 =                                                                                                       +
         Project (#0..=#2) // { arity: 3 }                                                                            +
           Join on=(#1{id} = #3{id}) type=differential // { arity: 4 }                                                +
             implementation                                                                                           +
               %1[#0]UKA » %0:l0[#1]K                                                                                 +
             ArrangeBy keys=[[#1{id}]] // { arity: 3 }                                                                +
               Get l0 // { arity: 3 }                                                                                 +
             ArrangeBy keys=[[#0{id}]] // { arity: 1 }                                                                +
               Distinct project=[#0{id}] // { arity: 1 }                                                              +
                 Project (#1) // { arity: 1 }                                                                         +
                   ReadIndex on=materialize.public.person person_locationcityid=[lookup value=(1138)] // { arity: 12 }+
   With Mutually Recursive                                                                                            +
     cte l0 =                                                                                                         +
       Reduce group_by=[#0{id}, #1{id}] aggregates=[min(#2)] // { arity: 3 }                                          +
         Distinct project=[#0{id}..=#2] // { arity: 3 }                                                               +
           Union // { arity: 3 }                                                                                      +
             Project (#1, #1, #12) // { arity: 3 }                                                                    +
               Map (0) // { arity: 13 }                                                                               +
                 ReadIndex on=materialize.public.person person_locationcityid=[lookup value=(655)] // { arity: 12 }   +
             Project (#0, #4, #6) // { arity: 3 }                                                                     +
               Map ((#2 + bigint_to_double(#5{w}))) // { arity: 7 }                                                   +
                 Join on=(#1 = #3{src}) type=differential // { arity: 6 }                                             +
                   implementation                                                                                     +
                     %1:pathq19[#0]KA » %0:l0[#1]K                                                                    +
                   ArrangeBy keys=[[#1]] // { arity: 3 }                                                              +
                     Get l0 // { arity: 3 }                                                                           +
                   ArrangeBy keys=[[#0{src}]] // { arity: 3 }                                                         +
                     ReadIndex on=pathq19 pathq19_src=[differential join] // { arity: 3 }                             +
                                                                                                                      +
 Used Indexes:                                                                                                        +
   - materialize.public.person_locationcityid (lookup)                                                                +
   - materialize.public.pathq19_src (differential join)                                                               +
 
(1 row)

Time: 38.465 ms
Q18 RUN 1
   person1.id   |   person2.id   | mutualfriendcount 
----------------+----------------+-------------------
  2199023256539 | 24189255821523 |                31
 24189255821523 |  2199023256539 |                31
 15393162796970 | 24189255820514 |                25
 24189255820514 | 15393162796970 |                25
  4398046511410 | 13194139543082 |                23
 10995116284091 | 24189255815677 |                23
 13194139543082 |  4398046511410 |                23
 24189255815677 | 10995116284091 |                23
 24189255819695 | 24189255821523 |                20
 24189255821523 | 24189255819695 |                20
 24189255820514 | 24189255821523 |                18
 24189255821523 | 24189255820514 |                18
  2199023256539 | 15393162796970 |                17
  2199023256539 | 24189255819695 |                17
 13194139536963 | 13194139543082 |                17
 13194139543082 | 13194139536963 |                17
 15393162796970 |  2199023256539 |                17
 17592186050431 | 26388279069225 |                17
 24189255819695 |  2199023256539 |                17
 26388279069225 | 17592186050431 |                17
(20 rows)

Time: 485.763 ms
Q18 RUN 2
   person1.id   |   person2.id   | mutualfriendcount 
----------------+----------------+-------------------
  2199023256539 | 24189255821523 |                31
 24189255821523 |  2199023256539 |                31
 15393162796970 | 24189255820514 |                25
 24189255820514 | 15393162796970 |                25
  4398046511410 | 13194139543082 |                23
 10995116284091 | 24189255815677 |                23
 13194139543082 |  4398046511410 |                23
 24189255815677 | 10995116284091 |                23
 24189255819695 | 24189255821523 |                20
 24189255821523 | 24189255819695 |                20
 24189255820514 | 24189255821523 |                18
 24189255821523 | 24189255820514 |                18
  2199023256539 | 15393162796970 |                17
  2199023256539 | 24189255819695 |                17
 13194139536963 | 13194139543082 |                17
 13194139543082 | 13194139536963 |                17
 15393162796970 |  2199023256539 |                17
 17592186050431 | 26388279069225 |                17
 24189255819695 |  2199023256539 |                17
 26388279069225 | 17592186050431 |                17
(20 rows)

Time: 554.791 ms
Q18 RUN 3
   person1.id   |   person2.id   | mutualfriendcount 
----------------+----------------+-------------------
  2199023256539 | 24189255821523 |                31
 24189255821523 |  2199023256539 |                31
 15393162796970 | 24189255820514 |                25
 24189255820514 | 15393162796970 |                25
  4398046511410 | 13194139543082 |                23
 10995116284091 | 24189255815677 |                23
 13194139543082 |  4398046511410 |                23
 24189255815677 | 10995116284091 |                23
 24189255819695 | 24189255821523 |                20
 24189255821523 | 24189255819695 |                20
 24189255820514 | 24189255821523 |                18
 24189255821523 | 24189255820514 |                18
  2199023256539 | 15393162796970 |                17
  2199023256539 | 24189255819695 |                17
 13194139536963 | 13194139543082 |                17
 13194139543082 | 13194139536963 |                17
 15393162796970 |  2199023256539 |                17
 17592186050431 | 26388279069225 |                17
 24189255819695 |  2199023256539 |                17
 26388279069225 | 17592186050431 |                17
(20 rows)

Time: 418.923 ms

Q19 EXPLAINED
                                                                                                                  Optimized Plan                                                                                                                   
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 materialize.public.pathq19:                                                                                                                                                                                                                      +
   Return // { arity: 3 }                                                                                                                                                                                                                         +
     Union // { arity: 3 }                                                                                                                                                                                                                        +
       Get l0 // { arity: 3 }                                                                                                                                                                                                                     +
       Project (#1, #0, #2) // { arity: 3 }                                                                                                                                                                                                       +
         Get l0 // { arity: 3 }                                                                                                                                                                                                                   +
   With                                                                                                                                                                                                                                           +
     cte l0 =                                                                                                                                                                                                                                     +
       Project (#0, #1, #3) // { arity: 3 }                                                                                                                                                                                                       +
         Map (greatest(f64toi64(roundf64((40 - sqrtf64(bigint_to_double(#2))))), 1)) // { arity: 4 }                                                                                                                                              +
           Reduce group_by=[#0{person1id}, #1{person2id}] aggregates=[count(*)] // { arity: 3 }                                                                                                                                                   +
             Project (#27, #28) // { arity: 2 }                                                                                                                                                                                                   +
               Filter (#12{parentmessageid}) IS NOT NULL AND (#9{creatorpersonid} != #22{creatorpersonid}) AND (#27{person1id} < #28{person2id}) // { arity: 29 }                                                                                 +
                 Join on=(#12{parentmessageid} = #14{messageid} AND #27{person1id} = least(#9{creatorpersonid}, #22{creatorpersonid}) AND #28{person2id} = greatest(#9{creatorpersonid}, #22{creatorpersonid})) type=differential // { arity: 29 }+
                   implementation                                                                                                                                                                                                                 +
                     %0:message[#12]KA » %1:message[#1]KA » %2:person_knows_person[#1, #2]KKAf                                                                                                                                                    +
                   ArrangeBy keys=[[#12{parentmessageid}]] // { arity: 13 }                                                                                                                                                                       +
                     ReadIndex on=message message_parentmessageid=[differential join] // { arity: 13 }                                                                                                                                            +
                   ArrangeBy keys=[[#1{messageid}]] // { arity: 13 }                                                                                                                                                                              +
                     ReadIndex on=message message_messageid=[differential join] // { arity: 13 }                                                                                                                                                  +
                   ArrangeBy keys=[[#1{person1id}, #2{person2id}]] // { arity: 3 }                                                                                                                                                                +
                     ReadIndex on=person_knows_person person_knows_person_person1id_person2id=[differential join] // { arity: 3 }                                                                                                                 +
                                                                                                                                                                                                                                                  +
 Used Indexes:                                                                                                                                                                                                                                    +
   - materialize.public.person_knows_person_person1id_person2id (differential join)                                                                                                                                                               +
   - materialize.public.message_messageid (differential join)                                                                                                                                                                                     +
   - materialize.public.message_parentmessageid (differential join)                                                                                                                                                                               +
 
(1 row)

Time: 16.940 ms
CREATE MATERIALIZED VIEW
Time: 452.926 ms
CREATE INDEX
Time: 583.468 ms
                                                    Optimized Plan                                                     
-----------------------------------------------------------------------------------------------------------------------
 Explained Query:                                                                                                     +
   Return // { arity: 3 }                                                                                             +
     Return // { arity: 3 }                                                                                           +
       Project (#0..=#2) // { arity: 3 }                                                                              +
         Join on=(#2 = #3) type=differential // { arity: 4 }                                                          +
           implementation                                                                                             +
             %1[#0]UK » %0:l1[#2]K                                                                                    +
           ArrangeBy keys=[[#2]] // { arity: 3 }                                                                      +
             Filter (#2) IS NOT NULL // { arity: 3 }                                                                  +
               Get l1 // { arity: 3 }                                                                                 +
           ArrangeBy keys=[[#0]] // { arity: 1 }                                                                      +
             Filter (#0) IS NOT NULL // { arity: 1 }                                                                  +
               Reduce aggregates=[min(#0)] // { arity: 1 }                                                            +
                 Project (#2) // { arity: 1 }                                                                         +
                   Get l1 // { arity: 3 }                                                                             +
     With                                                                                                             +
       cte l1 =                                                                                                       +
         Project (#0..=#2) // { arity: 3 }                                                                            +
           Join on=(#1{id} = #3{id}) type=differential // { arity: 4 }                                                +
             implementation                                                                                           +
               %1[#0]UKA » %0:l0[#1]K                                                                                 +
             ArrangeBy keys=[[#1{id}]] // { arity: 3 }                                                                +
               Get l0 // { arity: 3 }                                                                                 +
             ArrangeBy keys=[[#0{id}]] // { arity: 1 }                                                                +
               Distinct project=[#0{id}] // { arity: 1 }                                                              +
                 Project (#1) // { arity: 1 }                                                                         +
                   ReadIndex on=materialize.public.person person_locationcityid=[lookup value=(1138)] // { arity: 12 }+
   With Mutually Recursive                                                                                            +
     cte l0 =                                                                                                         +
       Reduce group_by=[#0{id}, #1{id}] aggregates=[min(#2)] // { arity: 3 }                                          +
         Distinct project=[#0{id}..=#2] // { arity: 3 }                                                               +
           Union // { arity: 3 }                                                                                      +
             Project (#1, #1, #12) // { arity: 3 }                                                                    +
               Map (0) // { arity: 13 }                                                                               +
                 ReadIndex on=materialize.public.person person_locationcityid=[lookup value=(655)] // { arity: 12 }   +
             Project (#0, #4, #6) // { arity: 3 }                                                                     +
               Map ((#2 + bigint_to_double(#5{w}))) // { arity: 7 }                                                   +
                 Join on=(#1 = #3{src}) type=differential // { arity: 6 }                                             +
                   implementation                                                                                     +
                     %1:pathq19[#0]KA » %0:l0[#1]K                                                                    +
                   ArrangeBy keys=[[#1]] // { arity: 3 }                                                              +
                     Get l0 // { arity: 3 }                                                                           +
                   ArrangeBy keys=[[#0{src}]] // { arity: 3 }                                                         +
                     ReadIndex on=pathq19 pathq19_src=[differential join] // { arity: 3 }                             +
                                                                                                                      +
 Used Indexes:                                                                                                        +
   - materialize.public.person_locationcityid (lookup)                                                                +
   - materialize.public.pathq19_src (differential join)                                                               +
 
(1 row)

Time: 27.315 ms
Q19 RUN 1
CREATE MATERIALIZED VIEW
Time: 754.151 ms
CREATE INDEX
Time: 459.414 ms
      src       |      dst       | w  
----------------+----------------+----
 24189255818627 | 26388279072272 | 39
(1 row)

Time: 6297.098 ms (00:06.297)
Time: 19.690 ms
Q19 RUN 2
CREATE MATERIALIZED VIEW
Time: 483.480 ms
CREATE INDEX
Time: 515.339 ms
      src       |      dst       | w  
----------------+----------------+----
 24189255818627 | 26388279072272 | 39
(1 row)

Time: 5591.200 ms (00:05.591)
Time: 12.193 ms
Q19 RUN 3
CREATE MATERIALIZED VIEW
Time: 521.431 ms
CREATE INDEX
Time: 614.344 ms
      src       |      dst       | w  
----------------+----------------+----
 24189255818627 | 26388279072272 | 39
(1 row)

Time: 5427.199 ms (00:05.427)
Time: 10.488 ms

Q20 EXPLAINED
                                                                        Optimized Plan                                                                        
--------------------------------------------------------------------------------------------------------------------------------------------------------------
 materialize.public.pathq20:                                                                                                                                 +
   Project (#0, #1, #3) // { arity: 3 }                                                                                                                      +
     Map ((#2 + 1)) // { arity: 4 }                                                                                                                          +
       Reduce group_by=[#0{person1id}, #1{person2id}] aggregates=[min(abs((#2{classyear} - #3{classyear})))] // { arity: 3 }                                 +
         Project (#1, #2, #6, #9) // { arity: 4 }                                                                                                            +
           Join on=(#1{person1id} = #4{personid} AND #2{person2id} = #7{personid} AND #5{universityid} = #8{universityid}) type=differential // { arity: 10 }+
             implementation                                                                                                                                  +
               %0:person_knows_person[#1]KA » %1:person_studyat_university[#1]KA » %2:person_studyat_university[#0, #1]KK                                    +
             ArrangeBy keys=[[#1{person1id}]] // { arity: 3 }                                                                                                +
               ReadIndex on=person_knows_person person_knows_person_person1id=[differential join] // { arity: 3 }                                            +
             ArrangeBy keys=[[#1{personid}]] // { arity: 4 }                                                                                                 +
               ReadIndex on=person_studyat_university person_studyat_university_personid=[differential join] // { arity: 4 }                                 +
             ArrangeBy keys=[[#0{personid}, #1{universityid}]] // { arity: 3 }                                                                               +
               Project (#1..=#3) // { arity: 3 }                                                                                                             +
                 ReadIndex on=person_studyat_university person_studyat_university_personid=[*** full scan ***] // { arity: 4 }                               +
                                                                                                                                                             +
 Used Indexes:                                                                                                                                               +
   - materialize.public.person_studyat_university_personid (*** full scan ***, differential join)                                                            +
   - materialize.public.person_knows_person_person1id (differential join)                                                                                    +
 
(1 row)

Time: 14.504 ms
CREATE MATERIALIZED VIEW
Time: 466.166 ms
CREATE INDEX
Time: 619.320 ms
                                                          Optimized Plan                                                          
----------------------------------------------------------------------------------------------------------------------------------
 Explained Query:                                                                                                                +
   Finish order_by=[#0{dst} asc nulls_last] limit=20 output=[#0, #1]                                                             +
     Return // { arity: 2 }                                                                                                      +
       Return // { arity: 2 }                                                                                                    +
         Project (#0, #1) // { arity: 2 }                                                                                        +
           Filter (#1 = #3) // { arity: 4 }                                                                                      +
             Join on=(#1 = #2) type=differential // { arity: 4 }                                                                 +
               implementation                                                                                                    +
                 %1[#0]UKAf » %0:l1[#1]Kf                                                                                        +
               ArrangeBy keys=[[#1]] // { arity: 2 }                                                                             +
                 Get l1 // { arity: 2 }                                                                                          +
               ArrangeBy keys=[[#0]] // { arity: 2 }                                                                             +
                 Reduce group_by=[#0] aggregates=[min(#1)] // { arity: 2 }                                                       +
                   CrossJoin type=differential // { arity: 2 }                                                                   +
                     implementation                                                                                              +
                       %0[×] » %1:l2[×]                                                                                          +
                     ArrangeBy keys=[[]] // { arity: 1 }                                                                         +
                       Distinct project=[#0] // { arity: 1 }                                                                     +
                         Get l2 // { arity: 1 }                                                                                  +
                     ArrangeBy keys=[[]] // { arity: 1 }                                                                         +
                       Get l2 // { arity: 1 }                                                                                    +
       With                                                                                                                      +
         cte l2 =                                                                                                                +
           Project (#1) // { arity: 1 }                                                                                          +
             Get l1 // { arity: 2 }                                                                                              +
         cte l1 =                                                                                                                +
           Project (#0, #1) // { arity: 2 }                                                                                      +
             Join on=(#0{dst} = #2{personid}) type=differential // { arity: 3 }                                                  +
               implementation                                                                                                    +
                 %1[#0]UKA » %0:l0[#0]UK                                                                                         +
               ArrangeBy keys=[[#0{dst}]] // { arity: 2 }                                                                        +
                 Project (#1, #2) // { arity: 2 }                                                                                +
                   Get l0 // { arity: 3 }                                                                                        +
               ArrangeBy keys=[[#0{personid}]] // { arity: 1 }                                                                   +
                 Distinct project=[#0{personid}] // { arity: 1 }                                                                 +
                   Project (#1) // { arity: 1 }                                                                                  +
                     Filter (#5{name} = "National_Airlines_(5M)") // { arity: 8 }                                                +
                       Join on=(#2{companyid} = #4{id}) type=differential // { arity: 8 }                                        +
                         implementation                                                                                          +
                           %1:company[#0]KAef » %0:person_workat_company[#2]KAef                                                 +
                         ArrangeBy keys=[[#2{companyid}]] // { arity: 4 }                                                        +
                           ReadIndex on=person_workat_company person_workat_company_companyid=[differential join] // { arity: 4 }+
                         ArrangeBy keys=[[#0{id}]] // { arity: 4 }                                                               +
                           ReadIndex on=company company_id=[differential join] // { arity: 4 }                                   +
     With Mutually Recursive                                                                                                     +
       cte l0 =                                                                                                                  +
         Project (#2, #0, #1) // { arity: 3 }                                                                                    +
           Map (13194139540317) // { arity: 3 }                                                                                  +
             Reduce group_by=[#0{dst}] aggregates=[min(#1)] // { arity: 2 }                                                      +
               Distinct project=[#0{dst}, #1] // { arity: 2 }                                                                    +
                 Union // { arity: 2 }                                                                                           +
                   Project (#3, #5) // { arity: 2 }                                                                              +
                     Map ((#1 + integer_to_bigint(#4{w}))) // { arity: 6 }                                                       +
                       Join on=(#0 = #2{src}) type=differential // { arity: 5 }                                                  +
                         implementation                                                                                          +
                           %1:pathq20[#0]KA » %0:l0[#0]K                                                                         +
                         ArrangeBy keys=[[#0]] // { arity: 2 }                                                                   +
                           Project (#1, #2) // { arity: 2 }                                                                      +
                             Get l0 // { arity: 3 }                                                                              +
                         ArrangeBy keys=[[#0{src}]] // { arity: 3 }                                                              +
                           ReadIndex on=pathq20 pathq20_src=[differential join] // { arity: 3 }                                  +
                   Constant // { arity: 2 }                                                                                      +
                     - (13194139540317, 0)                                                                                       +
                                                                                                                                 +
 Used Indexes:                                                                                                                   +
   - materialize.public.person_workat_company_companyid (differential join)                                                      +
   - materialize.public.company_id (differential join)                                                                           +
   - materialize.public.pathq20_src (differential join)                                                                          +
 
(1 row)

Time: 26.958 ms
Q20 RUN 1
CREATE MATERIALIZED VIEW
Time: 668.077 ms
CREATE INDEX
Time: 377.965 ms
      dst       | w 
----------------+---
 24189255819104 | 3
(1 row)

Time: 64.136 ms
Time: 12.693 ms
Q20 RUN 2
CREATE MATERIALIZED VIEW
Time: 553.039 ms
CREATE INDEX
Time: 614.642 ms
      dst       | w 
----------------+---
 24189255819104 | 3
(1 row)

Time: 66.330 ms
Time: 12.771 ms
Q20 RUN 3
CREATE MATERIALIZED VIEW
Time: 623.766 ms
CREATE INDEX
Time: 500.537 ms
      dst       | w 
----------------+---
 24189255819104 | 3
(1 row)

Time: 70.016 ms
Time: 12.569 ms

DONE
2024-01-17T11:11:32-05:00