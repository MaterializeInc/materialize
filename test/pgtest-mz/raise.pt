# Test that the RAISE statement sends messages with the correct severity.

# Ensure all severity levels are actually sent to the client
send
Query {"query": "SET client_min_messages TO DEBUG"}
----

until
ReadyForQuery
----
CommandComplete {"tag":"SET"}
ReadyForQuery {"status":"I"}

send
Query {"query": "RAISE DEBUG"}
----

until
CommandComplete
ReadyForQuery
----
NoticeResponse {"fields":[{"typ":"S","value":"DEBUG"},{"typ":"C","value":"01000"},{"typ":"M","value":"raised a test debug"}]}
CommandComplete {"tag":"RAISE"}
ReadyForQuery {"status":"I"}

send
Query {"query": "RAISE INFO"}
----

until
ReadyForQuery
----
NoticeResponse {"fields":[{"typ":"S","value":"INFO"},{"typ":"C","value":"01000"},{"typ":"M","value":"raised a test info"}]}
CommandComplete {"tag":"RAISE"}
ReadyForQuery {"status":"I"}

send
Query {"query": "RAISE LOG"}
----

until
ReadyForQuery
----
NoticeResponse {"fields":[{"typ":"S","value":"LOG"},{"typ":"C","value":"01000"},{"typ":"M","value":"raised a test log"}]}
CommandComplete {"tag":"RAISE"}
ReadyForQuery {"status":"I"}

send
Query {"query": "RAISE NOTICE"}
----

until
ReadyForQuery
----
NoticeResponse {"fields":[{"typ":"S","value":"NOTICE"},{"typ":"C","value":"01000"},{"typ":"M","value":"raised a test notice"}]}
CommandComplete {"tag":"RAISE"}
ReadyForQuery {"status":"I"}

send
Query {"query": "RAISE WARNING"}
----

until
ReadyForQuery
----
NoticeResponse {"fields":[{"typ":"S","value":"WARNING"},{"typ":"C","value":"01000"},{"typ":"M","value":"raised a test warning"}]}
CommandComplete {"tag":"RAISE"}
ReadyForQuery {"status":"I"}

send
Query {"query": "RAISE NOTICE CODE '01234' DETAIL 'details here' HINT 'hints here'"}
----

until err_field_typs=CMSDH
CommandComplete
ReadyForQuery
----
NoticeResponse {"fields":[{"typ":"S","value":"NOTICE"},{"typ":"C","value":"01234"},{"typ":"M","value":"raised a test notice"},{"typ":"D","value":"details here"},{"typ":"H","value":"hints here"}]}
CommandComplete {"tag":"RAISE"}
ReadyForQuery {"status":"I"}
