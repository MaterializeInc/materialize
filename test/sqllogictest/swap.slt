# Copyright Materialize, Inc. and contributors. All rights reserved.
#
# Use of this software is governed by the Business Source License
# included in the LICENSE file at the root of this repository.
#
# As of the Change Date specified in that file, in accordance with
# the Business Source License, use of this software will be governed
# by the Apache License, Version 2.0.

mode standard

reset-server

statement ok
CREATE SCHEMA blue;

statement ok
CREATE TABLE blue.t1 (x int);

statement ok
INSERT INTO blue.t1 VALUES (1), (2), (3);

statement ok
CREATE SCHEMA green;

statement ok
CREATE TABLE green.t2 (y int);

statement ok
INSERT INTO green.t2 VALUES (4), (5), (6);

statement error db error: ERROR: unknown catalog item 'blue\.t2'
SELECT * FROM blue.t2;

statement ok
ALTER SCHEMA blue SWAP WITH green;

query I
SELECT * FROM blue.t2;
----
4
5
6

statement ok
CREATE SCHEMA "!\_\""w3ðŸ˜Š_weird_name";

statement ok
ALTER SCHEMA blue SWAP WITH "!\_\""w3ðŸ˜Š_weird_name";

query I
SELECT * FROM "!\_\""w3ðŸ˜Š_weird_name".t2;
----
4
5
6

statement ok
CREATE CLUSTER foo SIZE = '1';

statement ok
CREATE CLUSTER bar SIZE = '1';

statement ok
CREATE INDEX green_idx IN CLUSTER foo ON green.t1 (x);

query T
SELECT name FROM mz_clusters JOIN ( SELECT cluster_id FROM mz_indexes WHERE name = 'green_idx' ) my_index ON mz_clusters.id = my_index.cluster_id;
----
foo

statement ok
ALTER CLUSTER foo SWAP WITH bar;

query T
SELECT name FROM mz_clusters JOIN ( SELECT cluster_id FROM mz_indexes WHERE name = 'green_idx' ) my_index ON mz_clusters.id = my_index.cluster_id;
----
bar

# Cleanup.

statement ok
DROP CLUSTER foo CASCADE;

statement ok
DROP CLUSTER bar CASCADE;
