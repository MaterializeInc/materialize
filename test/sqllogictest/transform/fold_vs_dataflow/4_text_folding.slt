mode cockroach

# -------------------------------
# ILIKE operator
# -------------------------------

statement ok
CREATE TABLE t_data (f1 TEXT);

statement ok
INSERT INTO t_data VALUES ('ABCDEF'), ('abcdef'), ('aBcDeF'), ('AbCdEf');

query T
SELECT * FROM t_data
WHERE f1 ILIKE '%bCd%'
ORDER BY f1;
----
AbCdEf

query T multiline
EXPLAIN SELECT * FROM t_data
WHERE f1 ILIKE '%bCd%';
----
Explained Query:
  Filter "%bCd%" ~~(#0)
    Get materialize.public.t_data

Source materialize.public.t_data
  filter=("%bCd%" ~~(#0))

EOF

# -------------------------------
# Further text operators
# -------------------------------

statement ok
CREATE VIEW v_using_constant_folding (f1, f2, f3, f4, f1ls, f1rs) AS
SELECT
 'ABCDef', 'CD', 'cd', 'XX', ' ABCDef', 'ABCDef ';

query TTTTTTTTTT
SELECT
 f1 || f4,
 UPPER(f1), LOWER(f1),
 SUBSTRING(f1, 1),
 REPLACE(f1, f2, f3),
 POSITION(f2 IN f1),
 SPLIT_PART(f1, f2, 1),
 TRANSLATE(f1, 'C', 'Z'),
 REGEXP_MATCH(f1, f2),
 REGEXP_MATCH(f1, f3, 'i') AS case_insensitive
FROM v_using_constant_folding;
----
ABCDefXX  ABCDEF  abcdef  ABCDef  ABcdef  3  AB  ABZDef  {CD}  {CD}

query T multiline
EXPLAIN
SELECT
 f1 || f4,
 UPPER(f1), LOWER(f1),
 SUBSTRING(f1, 1),
 REPLACE(f1, f2, f3),
 POSITION(f2 IN f1),
 SPLIT_PART(f1, f2, 1),
 TRANSLATE(f1, 'C', 'Z'),
 REGEXP_MATCH(f1, f2),
 REGEXP_MATCH(f1, f3, 'i') AS case_insensitive
FROM v_using_constant_folding;
----
Explained Query (fast path):
  Constant
    - ("ABCDefXX", "ABCDEF", "abcdef", "ABCDef", "ABcdef", 3, "AB", "ABZDef", {"CD"}, {"CD"})

EOF

# -------------------------------
# Further text operators potentially involving spaces
# -------------------------------

# use mode standard due to spaces
mode standard

query TTTTTTT
SELECT
 BTRIM(f1ls), LTRIM(f1ls),
 BTRIM(f1rs), RTRIM(f1rs),
 LPAD(f1, 1),
 LPAD(f1, 10),
 LPAD(f1, 10, f2)
FROM v_using_constant_folding;
----
ABCDef
ABCDef
ABCDef
ABCDef
A
    ABCDef
CDCDABCDef

query T multiline
EXPLAIN
SELECT
 BTRIM(f1ls), LTRIM(f1ls),
 BTRIM(f1rs), RTRIM(f1rs),
 LPAD(f1, 1),
 LPAD(f1, 10),
 LPAD(f1, 10, f2)
FROM v_using_constant_folding;
----
Explained Query (fast path):
  Constant
    - ("ABCDef", "ABCDef", "ABCDef", "ABCDef", "A", "    ABCDef", "CDCDABCDef")

EOF
