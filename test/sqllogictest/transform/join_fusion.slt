# Copyright Materialize, Inc. All rights reserved.
#
# Use of this software is governed by the Business Source License
# included in the LICENSE file at the root of this repository.
#
# As of the Change Date specified in that file, in accordance with
# the Business Source License, use of this software will be governed
# by the Apache License, Version 2.0.

mode cockroach

statement ok
CREATE TABLE t1 (f1 integer, f2 integer)

statement ok
INSERT INTO t1 VALUES (1, 1), (2, 3), (4, 5);

statement ok
CREATE TABLE t2 (f1 integer, f2 integer)

statement ok
INSERT INTO t2 VALUES (2, 3), (5, 5);

statement ok
CREATE TABLE t3 (f1 integer, f2 integer)

statement ok
INSERT INTO t3 VALUES (2, 3), (5, 5);

query T multiline
EXPLAIN SELECT * FROM t1 INNER JOIN t2 ON t2.f2 = t1.f2 INNER JOIN t3 ON t1.f1 = t3.f1 WHERE t1.f1 <= t2.f1 AND t3.f1 > 0;
----
%0 =
| Get materialize.public.t1 (u1)
| Filter !(isnull(#0)), !(isnull(#1)), (#0 > 0)
| ArrangeBy (#0)

%1 =
| Get materialize.public.t2 (u3)
| Filter !(isnull(#1))
| ArrangeBy (#1)

%2 =
| Get materialize.public.t3 (u5)
| Filter !(isnull(#0)), (#0 > 0)

%3 =
| Join %0 %1 %2 (= #0 #4) (= #1 #3)
| | implementation = Differential %2 %0.(#0) %1.(#1)
| | demand = (#0..#2, #5)
| Filter (#0 <= #2)
| Project (#0..#2, #1, #0, #5)

EOF

query IIIIII
SELECT * FROM t1 INNER JOIN t2 ON t2.f2 = t1.f2 INNER JOIN t3 ON t1.f1 = t3.f1 WHERE t1.f1 <= t2.f1 AND t3.f1 > 0;
----
2  3  2  3  2  3
